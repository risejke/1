<!DOCTYPE html>
<html lang="ru">

  <head>
    <title>Немного про современные технологии Greybox-фаззинга &#x2F; Хабр</title>
<meta property="fb:app_id" content="444736788986613">
<meta property="fb:pages" content="472597926099084">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@habr_com">
<meta property="og:site_name" content="Хабр">
<link href="https://habr.com/ru/rss/post/570312/?fl=ru" type="application/rss+xml" title rel="alternate" name="rss">
<link href="https://habr.com/ru/companies/bizone/articles/570312/" rel="canonical" data-hid="e3fa780">
<link rel="image_src" href="https://habrastorage.org/webt/la/co/s6/lacos6umd28xl-pd9mprrpxikle.jpeg" data-hid="2a79c45">
<meta property="og:title" content="Немного про современные технологии Greybox-фаззинга">
<meta name="twitter:title" content="Немного про современные технологии Greybox-фаззинга">
<meta name="aiturec:title" content="Немного про современные технологии Greybox-фаззинга">
<meta name="description" content="Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема:...">
<meta itemprop="description" content="Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема:...">
<meta property="og:description" content="Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема:...">
<meta name="twitter:description" content="Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема:...">
<meta property="aiturec:description" content="Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема:...">
<meta itemprop="image" content="https://habrastorage.org/webt/la/co/s6/lacos6umd28xl-pd9mprrpxikle.jpeg">
<meta property="og:image" content="https://habrastorage.org/webt/la/co/s6/lacos6umd28xl-pd9mprrpxikle.jpeg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="aiturec:image" content="https://habrastorage.org/webt/la/co/s6/lacos6umd28xl-pd9mprrpxikle.jpeg">
<meta name="twitter:image" content="https://habrastorage.org/webt/la/co/s6/lacos6umd28xl-pd9mprrpxikle.jpeg">
<meta property="vk:image" content="https://habrastorage.org/webt/la/co/s6/lacos6umd28xl-pd9mprrpxikle.jpeg?format=vk">
<meta property="vk:image" content="https://habrastorage.org/webt/la/co/s6/lacos6umd28xl-pd9mprrpxikle.jpeg?format=vk">
<meta property="aiturec:item_id" content="570312">
<meta property="aiturec:datetime" content="2021-08-02T09:13:04.000Z">
<meta content="https://habr.com/ru/companies/bizone/articles/570312/" property="og:url">
<meta property="og:type" content="article">
<meta property="og:locale" content="ru_RU">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="keywords" content="уязвимости, фаззинг, тестирование по, информационная безопасность, взлом">
<script type="application/ld+json" data-hid="1e0f0a2">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/companies\/bizone\/articles\/570312\/"},"headline":"Немного про современные технологии Greybox-фаззинга","datePublished":"2021-08-02T12:13:04+03:00","dateModified":"2021-08-02T13:44:41+03:00","author":{"@type":"Person","name":"BI.ZONE"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы...","url":"https:\/\/habr.com\/ru\/companies\/bizone\/articles\/570312\/#post-content-body","about":["c_bizone","h_infosecurity","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/570312\/0f6edfc8ddad89c46f16587041aa0871\/","https:\/\/habrastorage.org\/webt\/jr\/ea\/j-\/jreaj-lia98n2khuvvh8ifghau0.jpeg","https:\/\/habrastorage.org\/webt\/ry\/bx\/6c\/rybx6cexi52bk_t8jqats6nzb7m.png","https:\/\/habrastorage.org\/webt\/zg\/ii\/_5\/zgii_5b35x5dz85awo9qqzxdzk0.png","https:\/\/habrastorage.org\/getpro\/habr\/formulas\/0ba\/8fc\/59b\/0ba8fc59bafc5603168abebe244053a2.svg","https:\/\/habrastorage.org\/webt\/wz\/x9\/d9\/wzx9d93q5x_3ox47vzbqpbgyqo0.png","https:\/\/habrastorage.org\/webt\/uo\/7l\/3q\/uo7l3qqa7nseayv8do93sqbds5y.png","https:\/\/habrastorage.org\/webt\/h5\/iu\/ub\/h5iuubphfwaxivlpeavmoj3qowy.png","https:\/\/habrastorage.org\/webt\/av\/na\/us\/avnausmdvvsd525jpbjdacjqr4y.gif","https:\/\/habrastorage.org\/webt\/a1\/wi\/cg\/a1wicg-krx1u7cyoo9ycflpq_ry.gif","https:\/\/habrastorage.org\/webt\/da\/7w\/g3\/da7wg3ueknjfpfa-qmhgao5w4rc.gif"]}</script>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
    <meta name="referrer" content="unsafe-url">
    <style>
      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmojLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvk4jLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmYjLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvl4jLazX3dA.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
    <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" as="style" media="(prefers-color-scheme: light)" /><link rel="preload" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" as="style" media="(prefers-color-scheme: dark)" /><link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" media="(prefers-color-scheme: light)" /><link id="dark-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" media="(prefers-color-scheme: dark)" />
    <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.224b7808c0b4ff1c819aa3bd08558de3.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
    <style>
      .grecaptcha-badge {
        visibility: hidden;
      }
    </style>
    <meta name="habr-version" content="2.244.2">
    
    <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
    <meta name="msapplication-TileColor" content="#629FBC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png">
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png">
    <link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png">
    <link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png">
    <link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png">
    <link rel="apple-touch-icon" type="image/png" sizes="256x256" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png">
    <link rel="mask-icon" color="#77a2b6" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg">
    <link crossorigin="use-credentials" href="/manifest.webmanifest" rel="manifest">
    <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
    <script>window.yaContextCb = window.yaContextCb || []</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.2fa29ba9.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.2d437755.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.9d978772.js" as="script"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.2d437755.css"></head>
  <body>
    
    <div id="mount"><div id="app"><div class="tm-layout__wrapper"><!--[--><!----><div></div><!----><header class="tm-header" data-test-id="header"><div class="tm-page-width"><!--[--><div class="tm-header__container"><!----><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a><span style="display:none;" class="tm-header__beta-sign">β</span></span><!--[--><div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><!--[--><button class="tm-header__dropdown-toggle"><svg class="tm-svg-img tm-header__icon tm-header__icon_dropdown" height="16" width="16"><title>Открыть список</title><use xlink:href="/img/megazord-v28.7909a852..svg#arrow-down"></use></svg></button><!--]--></div><!----></div><a href="/ru/sandbox/start/" class="tm-header__become-author-btn">Как стать автором</a><!----><!----><!--]--><!----></div><!--]--></div></header><div class="tm-layout"><div class="tm-page-progress-bar"></div><div class="tm-base-layout__header_is-sticky tm-base-layout__header" data-menu-sticky="true"><div class="tm-page-width"><!--[--><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/feed/">Моя лента</a><!--]--><!--[--><a class="tm-main-menu__item" href="/ru/articles/">Все потоки</a><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/develop/">Разработка</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/admin/">Администрирование</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/design/">Дизайн</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/management/">Менеджмент</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/marketing/">Маркетинг</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/popsci/">Научпоп</a><!--]--><!--]--></nav></div></div><div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark" height="24" width="24"><title>Поиск</title><use xlink:href="/img/megazord-v28.7909a852..svg#search"></use></svg></a><!----><!----><div class="tm-header-user-menu__item tm-header-user-menu__write"><div><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write tm-header-user-menu__icon_dark" height="24" width="24"><title>Написать публикацию</title><use xlink:href="/img/megazord-v28.7909a852..svg#write"></use></svg></div><!----></div><!--[--><div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_dark" height="24" width="24"><title>Настройки</title><use xlink:href="/img/megazord-v28.7909a852..svg#page-settings"></use></svg></button></div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/companies/bizone/articles/570312/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item"><!--[--><button class="btn btn_solid btn_small tm-header-user-menu__login" type="button"><!--[-->Войти<!--]--></button><!--]--></a><!--]--><!----><!--teleport start--><!--teleport end--><!----></div></div><!--]--></div></div><!----><div class="tm-page-width"><!--[--><!--]--></div><main class="tm-layout__container"><div class="tm-page" hl="ru" companyname="bizone" data-async-called="true" style="--5ab2e5a8:16px;--44c4f6f6:100%;--45ba7a3b:0;"><div class="tm-page-width"><!--[--><div class="tm-page__header"><!--[--><!--]--></div><div class="tm-page__wrapper"><div class="tm-page__main_has-sidebar tm-page__main"><div class="pull-down"><!----><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24"><title>Обновить</title><use xlink:href="/img/megazord-v28.7909a852..svg#pull-arrow"></use></svg></div></div><!--[--><!--[--><div class="tm-article-presenter"><!--[--><!--[--><!----><div class="tm-company-profile-card tm-company-article__profile-card"><div class="tm-company-card tm-company-profile-card__info"><div class="tm-company-card__header"><a href="/ru/companies/bizone/profile/" class="tm-company-card__avatar"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="48" src="//habrastorage.org/getpro/habr/company/606/14d/823/60614d8230f985b3acdf792bbfe88d35.png" width="48"></div></a><!--[--><!----><div class="tm-counter-container tm-company-card__rating"><div class="tm-counter-container__header"><!--[--><!--[--><!--]--><div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----><div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score"><!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">62.35</span></span><!--]--></div><!----></div><!--]--></div><div class="tm-counter-container__footer"><!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]--></div></div><!----><!--]--></div><div class="tm-company-card__info"><a href="/ru/companies/bizone/profile/" class="tm-company-card__name"><span>BI.ZONE</span></a><!----></div></div><div class="tm-company-profile-card__buttons"><div class="tm-button-follow tm-company-profile-card__button tm-company-profile-card__button_follow"><!----><button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button></div><!----><!----><!----></div></div><!----><!--]--><!--]--><div class="tm-article-presenter__body" data-test-id="article-body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><!--[--><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><!--[--><div class="tm-article-presenter__header"><!--[--><!--]--><div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet"><!--[--><!--]--><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/BiZone_team/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="BiZone_team"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/f4e/26e/0ff/f4e26e0ffc7aac66add13ccce18c9880.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/BiZone_team/" class="tm-user-info__username">BiZone_team <!----></a><!--[--><span class="tm-article-datetime-published"><time datetime="2021-08-02T09:13:04.000Z" title="2021-08-02, 12:13">2  авг  2021 в 12:13</time></span><!--]--></span></span></div><!----></div><h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle"><span>Немного про современные технологии Greybox-фаззинга</span></h1><div class="tm-article-snippet__stats" data-test-id="articleStats"><!----><div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title><use xlink:href="/img/megazord-v28.7909a852..svg#clock"></use></svg></span><span class="tm-article-reading-time__label">20 мин</span></div><span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-views"></use></svg><span class="tm-icon-counter__value" title="8770">8.8K</span></span></div><div class="tm-publication-hubs__container" data-test-id="articleHubsList"><div class="tm-publication-hubs"><!--[--><span class="tm-publication-hub__link-container"><a href="/ru/companies/bizone/articles/" class="tm-publication-hub__link"><!--[--><span>Блог компании BI.ZONE</span><!----><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/infosecurity/" class="tm-publication-hub__link"><!--[--><span>Информационная безопасность</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><!--]--></div></div><div class="tm-article-labels" data-test-id="articleLabels" data-v-9fa2fafc><div class="tm-article-labels__container" data-v-9fa2fafc><!----><!--[--><!----><!--[--><!--]--><!--]--></div></div><!----><!----></div></div><!--[--><!----><div class="tm-article-body" data-gallery-root lang="ru"><div><!--[--><!--]--></div><div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p><img src="https://habrastorage.org/r/w1560/webt/jr/ea/j-/jreaj-lia98n2khuvvh8ifghau0.jpeg" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/webt/jr/ea/j-/jreaj-lia98n2khuvvh8ifghau0.jpeg 780w,&#10;       https://habrastorage.org/r/w1560/webt/jr/ea/j-/jreaj-lia98n2khuvvh8ifghau0.jpeg 781w" loading="lazy" decode="async"/></p><br/>
<p>Автор: <a href="https://twitter.com/rumata888">Иннокентий Сенновский</a></p><br/>
<h2 id="kak-nayti-bagi-o-kotoryh-vy-i-ne-dogadyvalis-ili-chto-takoe-fazzing">Как найти баги, о которых вы и не догадывались, или что такое фаззинг</h2><br/>
<p>Все уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема: разработчик может защититься только от багов, которые он способен предугадать. Да и тестировщик вряд ли сможет перебрать все варианты входных данных, которые приводят к ошибке.</p><br/>
<p>Чтобы справиться с этой проблемой, придумали фаззеры — инструменты тестирования, которые сами пытаются найти баги в программе. В этой статье я рассмотрю, какие они вообще бывают (для C/C++, потому что баги в таких программах особенно болезненны), но сделаю упор на Greybox-фаззеры (почему, расскажу в статье).</p><a name="habracut"></a><br/>
<p>Речь пойдет не об инструментах пентестеров, вроде Dirbuster или Burp Suite, которые проверяют программы на типичные проблемы и затрагивают лишь поверхность, а о фаззерах вроде AFL и LibFuzzer, которые тестируют программу, руководствуясь ее внутренним строением и механизмами.</p><br/>
<br/>
<h2 id="chto-takoe-fazzer">Что такое фаззер</h2><br/>
<p>Давайте начнем с того, что такое собственно фаззинг.</p><br/>
<p>Допустим, у нас есть программа, которую мы хотим протестировать. Будем называть ее на заморский манер — PUT (Program Under Test).</p><br/>
<p>В академической среде <em>фаззинг</em> — это когда мы исполняем PUT с использованием входных данных, которые расширяют входное пространство PUT. Если по-простому, то пытаемся найти данные, которые выявят новую функциональность в программе.</p><br/>
<p>Но в сфере кибербезопасности под фаззингом обычно подразумевают <em>фазз-тестирование</em>. Это когда мы используем фаззинг, чтобы проверить, что PUT не нарушает какую-либо политику безопасности. То есть мы смотрим, существуют ли данные, при которых поведение программы может сделать больно разработчику.</p><br/>
<p><em>Фаззер</em>, как следует из названия, это инструмент для проведения фаззинга. Его общий алгоритм можно высокоуровнево представить так:</p><br/>
<pre><code class="python">def FuzzTesting (Corpus, Tlimit):
    BugsFound = set()
    Corpus = Preprocess(Corpus)
    while (Telapsed &lt; Tlimit) and Continue(Corpus):
        configuration = Schedule(Corpus,Telapsed, Tlimit)
        testcases = InputGen(configuration)
        Bugs_new, execinfos = InputEval(configuration, testcases, BugOracle)
        Corpus = ConfUpdate(Corpus, Configuration, execinfos)
        BugsFound.add(Bugs_new)
    return (Corpus,BugsFound)</code></pre><br/>
<p>Сразу поясню две сущности, которые могли показаться непонятными:</p><br/>
<ul>
<li>Corpus (seed pool, корпус) — набор используемых фаззером входных данных, или тест-кейсов. Обычно фазз-тестирование запускают не на пустом корпусе. Если тестируют какую-то функцию, то сначала собирают образцы данных, которые подаются в нее при нормальной работе. Допустим, тестируя парсер изображений, подготавливают набор самых разных файлов, которые он должен обрабатывать. Это позволяет быстрее добраться до интересной функциональности и не тратить время на прохождение скучных проверок, таких как сигнатуры файлов.</li>
<li>Bug Oracle (оракул багов) — программа или модуль, которые детектируют нарушение политики безопасности, например опасные обращения к памяти или запись файла не туда. К оракулам багов я еще вернусь дальше в статье.</li>
</ul><br/>
<p>Таким образом, фаззер:</p><br/>
<ol>
<li>Обрабатывает начальные тест-кейсы, создавая корпус.</li>
<li>Входит в цикл фаззинга, который продолжается, пока не закончится время или не сработает некое условие.</li>
<li>Внутри цикла генерирует конфигурацию, а из нее — новые тест-кейсы.</li>
<li>Обрабатывает эти тест-кейсы, получает баги и информацию об исполнении.</li>
<li>На основе информации об исполнении расширяет корпус и добавляет баги.</li>
<li>После окончания фаззинга выдает корпус и найденные баги.<br/>
<br/>
<h2 id="vidy-fazzinga">Виды фаззинга</h2></li>
</ol><br/>
<p>Основных видов фаззинга — три:</p><br/>
<ol>
<li>Blackbox.</li>
<li>Whitebox.</li>
<li>Greybox.</li>
</ol><br/>
<p>В каждой статье должна быть хоть одна кринжовая картинка. Вот она:</p><br/>
<p><img src="https://habrastorage.org/r/w1560/webt/ry/bx/6c/rybx6cexi52bk_t8jqats6nzb7m.png" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/webt/ry/bx/6c/rybx6cexi52bk_t8jqats6nzb7m.png 780w,&#10;       https://habrastorage.org/r/w1560/webt/ry/bx/6c/rybx6cexi52bk_t8jqats6nzb7m.png 781w" loading="lazy" decode="async"/></p><br/>
<p><strong>Blackbox</strong> — самый примитивный вариант (инструменты — Burp Suite, DirBuster, Radamsa и др.). Обычно с их помощью пытаются найти типичные баги или баги в крайне дырявых программах. В этом случае информация об исполнении, которую фаззер получает при обращении к программе с указанным тест-кейсом, ограничена выводом программы или фактом ее отказа. Поэтому для большинства таких программ очень важны изначальные тест-кейсы.</p><br/>
<p><strong>Whitebox</strong> — самый тяжелый вариант (инструменты — KLEE и подобные). У него есть три самых явных подвида:</p><br/>
<ol>
<li><p>Symbolic Execution (символическое, оно же символьное, исполнение). При нем вместо преобразования кода программы в исполняемый код компилятор выплевывает набор формул, который описывает всю работу программы. Далее специальный решатель (обычно это SMT-решатель вроде <a href="https://github.com/Z3Prover/z3">z3</a>) преобразует <a href="https://en.wikipedia.org/wiki/Satisfiability_modulo_theories">SMT</a> в <a href="https://en.wikipedia.org/wiki/Boolean_satisfiability_problem">SAT</a> и пытается найти определенные пространства решений. Формулы модифицируются таким образом, чтобы пройти каждую ветвь исполнения изначальной программы. </p><br/>
<p>Если вы хотите поиграться с таким фаззером, воспользуйтесь старым и проверенным <a href="https://klee.github.io/">KLEE</a> или более новым и, на мой взгляд, простым <a href="https://github.com/eurecom-s3/symcc">SymCC</a>. Последний очень советую, если надо протестировать маленькую программу для парсинга файлов. </p><br/>
<p>У всех машин для символического исполнения есть одна проблема: в общем случае решение SAT, к которому в итоге приводятся программы, является NP-полной задачей. SMT-решатели находят решения за счет крайне эффективного упрощения теорем на каждом этапе, но чем больше программа и чем глубже в нее надо проникнуть, тем менее вероятно, что решатель справится за приемлемое время. </p><br/>
</li>
<li><p>Concolic Execution (конколическое исполнение). Это попытка немного упростить символическое исполнение за счет обогащения решателя данными от реального исполнения программы. Выполнили программу на известном тест-кейсе → сохранили данные → запустили решать попадание на другую ветвь с полученной информацией. </p><br/>
</li>
<li><p>Data Taint Tracking (термин на русском я не встречал). Это самый легкий с точки зрения вычислений метод, который относят к Whitebox-фаззингу. При исполнении программы все байты, которые зависят от определенных байтов входных данных, помечаются (taint). За счет этого фаззер отслеживает, что влияет на выбор пути исполнения, данные на какой позиции нужно менять.</p><br/>
</li>
</ol><br/>
<p>Blackbox туповат, Whitebox неэффективен для сложных программ и ест много ресурсов, поэтому придумали нечто среднее.</p><br/>
<p><strong>Greybox</strong> — это фаззинг, при котором каждый раз, когда PUT исполняет тест-кейс, фаззер получает не только информацию о выводе и падении программы (зачастую вывод вообще игнорируется), но и информацию о ходе исполнения программы.</p><br/>
<p>В общем случае информация может быть любой, но обычно используют такую метрику, как <em>покрытие кода программы</em>. Под этим подразумевают то, какие части программы были исполнены. Например, если рассмотреть программу как граф, покрытие может быть списком вершин, которые были пройдены при исполнении. Но может быть и чем-то другим — о видах покрытия я расскажу чуть позже.</p><br/>
<p>Покрытие программы используется как лакмусовая бумажка, чтобы определить, надо ли добавлять тест-кейс в корпус или он бесполезен. Если исполнение PUT достигает новой части программы (например, изменяет условие в каком-то if), то фаззер детектирует это событие и добавляет тест-кейс в корпус. Таким образом покрытие программы расширяется и вероятность обнаружения какой-то проблемы увеличивается.</p><br/>
<p>Дальше в статье я сосредоточусь именно на Greybox как на самом эффективном виде фазз-тестирования.</p><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Но есть случаи, когда обычный Greybox-фаззер уступает символическому исполнению</b>
                        <div class="spoiler_text"><p>Возьмем код, который требует решение системы линейных алгебраических уравнений на трех переменных:</p><br/>
<pre><code class="cpp">#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
int main(int argc, char* argv[]) {
    int coeffs[]={10, 2 , -3, 5, 6, 7, -11, 4, 0};
    int results[]={49, 70, -39};
    printf("What's the solution to the following system of  equations?\n");
    for (int i=0; i&lt;3; i++){
        printf("%d*x0 ",coeffs[i*3]);
        for (int j=1; j&lt;3; j++){
            int curCoeff=coeffs[i*3+j];
            if ( curCoeff &lt; 0){
                printf("- %d*x%d ",abs(curCoeff),j);
            } else if (curCoeff &gt; 0){
                printf("+ %d*x%d ",curCoeff,j);
            }
        }
        printf("= %d;\n",results[i]);
    }
    int solution[3];
    ssize_t result;
    printf("Reading %lu bytes for x1, x2, x3:\n",sizeof(int)*3);
    for (int i = 0; i&lt;3; i++)
    {
        if(read(STDIN_FILENO,&amp;solution[i],sizeof(int))!=sizeof(int)){
            printf ("Error reading\n");
            return -1;
        }
    }
    int success=1;
    for (int i = 0; i &lt; 3; i++){
        int accumulator=0;
        for (int j =0; j &lt; 3; j++) {
            accumulator+=coeffs[i*3+j]*solution[j];
        }
        if (accumulator!=results[i]){
            success=0;
            break;
        }
    }
    if (success)
        printf("Hooray!!!\n");
    else
        printf("Goodbye, DumDum\n");
    return 0;
}</code></pre><br/>
<p>Вот как сработает программа, если мы подадим на вход числа, которые не удовлетворяют системе уравнений :</p><br/>
<p><img src="https://habrastorage.org/r/w1560/webt/zg/ii/_5/zgii_5b35x5dz85awo9qqzxdzk0.png" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/webt/zg/ii/_5/zgii_5b35x5dz85awo9qqzxdzk0.png 780w,&#10;       https://habrastorage.org/r/w1560/webt/zg/ii/_5/zgii_5b35x5dz85awo9qqzxdzk0.png 781w" loading="lazy" decode="async"/></p><br/>
<p>(Да, у меня немного поехала нумерация переменных в принтах, но, когда выпускали статью, переделывать картинки уже было поздно.)</p><br/>
<p>Если скомпилировать эту программу, вероятность попадания Greybox-фаззера в точку будет <img src="https://habrastorage.org/getpro/habr/formulas/0ba/8fc/59b/0ba8fc59bafc5603168abebe244053a2.svg" alt="$\frac{1}{2^{96}}$" data-tex="inline" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/getpro/habr/formulas/0ba/8fc/59b/0ba8fc59bafc5603168abebe244053a2.svg 780w,&#10;       https://habrastorage.org/getpro/habr/formulas/0ba/8fc/59b/0ba8fc59bafc5603168abebe244053a2.svg 781w" loading="lazy" decode="async"/> ​(размер int на системе — 4 байта).</p><br/>
<p>А теперь давайте попробуем найти решение при помощи <a href="https://github.com/eurecom-s3/symcc">Whitebox-фаззера SymCC</a>.</p><br/>
<p>Клонируем SymCC. Собираем контейнер (так намного проще, чем устанавливать все зависимости и собирать компилятор на своей системе). Запускаем контейнер и пробрасываем папку с файлом (находимся в ней):</p><br/>
<pre><code class="bash">docker run --name=symcc_container -v $(pwd):/build_dir -it --rm symcc</code></pre><br/>
<p>Компилируем:</p><br/>
<pre><code class="bash">symcc symcc_example.c -o symcc_example</code></pre><br/>
<p>Заодно на хосте можно скомпилировать без символического исполнения, чтобы проверить результат позже:</p><br/>
<pre><code class="bash">clang symcc_example.c -o symmcc_example_nosym</code></pre><br/>
<p>Создадим несколько папок для результатов и пример ввода:</p><br/>
<pre><code class="bash">mkdir output/{1,2,3,4};
echo -n "TESTTESTTEST" &gt; first_input;</code></pre><br/>
<p>Несколько папок нужно, потому что на каждом запуске SymCC перезаписывает файлы в папке вывода. Если мы не хотим потерять предыдущие результаты, то лучше сохранять результаты в отдельные папки.</p><br/>
<p>Алгоритм работы SymCC достаточно прост:</p><br/>
<ol>
<li>Он исполняет скомпилированное приложение с предоставленным вводом, параллельно создавая символические правила.</li>
<li>Для каждого ветвления (if, while и др.) SymCC пытается поменять исполнение данной ветви на альтернативное, инвертировав условие.</li>
<li>SymCC пытается решить полученный набор теорем и выплевывает такой ввод, который приводит к выбранному графу исполнения, если фаззер смог его найти.</li>
</ol><br/>
<p>Из-за такого принципа работы использовать SymCC напрямую в качестве фаззера не очень удобно. Нужен какой-нибудь хэндлер (он есть в AFL++), чтобы проверять, найдена ли новая функциональность, и подавать на вход только те тест-кейсы, которые открыли новые ветви. В нашем случае программа очень простая и не содержит много ветвей, так что мы можем проделать этот путь вручную.</p><br/>
<p>Запустим с начальным тест-кейсом:</p><br/>
<p><img src="https://habrastorage.org/r/w1560/webt/wz/x9/d9/wzx9d93q5x_3ox47vzbqpbgyqo0.png" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/webt/wz/x9/d9/wzx9d93q5x_3ox47vzbqpbgyqo0.png 780w,&#10;       https://habrastorage.org/r/w1560/webt/wz/x9/d9/wzx9d93q5x_3ox47vzbqpbgyqo0.png 781w" loading="lazy" decode="async"/></p><br/>
<p>SymCC показывает вывод программы при исполнении ее с заданным тест-кейсом, а также информацию о затраченном на решение времени и полученных новых тест-кейсах.</p><br/>
<p>Давайте сразу отправим новый тест-кейс снова в SymCC:</p><br/>
<p><img src="https://habrastorage.org/r/w1560/webt/uo/7l/3q/uo7l3qqa7nseayv8do93sqbds5y.png" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/webt/uo/7l/3q/uo7l3qqa7nseayv8do93sqbds5y.png 780w,&#10;       https://habrastorage.org/r/w1560/webt/uo/7l/3q/uo7l3qqa7nseayv8do93sqbds5y.png 781w" loading="lazy" decode="async"/></p><br/>
<p>Получили три тест-кейса. Последний и есть решение уравнения:</p><br/>
<p><img src="https://habrastorage.org/r/w1560/webt/h5/iu/ub/h5iuubphfwaxivlpeavmoj3qowy.png" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/webt/h5/iu/ub/h5iuubphfwaxivlpeavmoj3qowy.png 780w,&#10;       https://habrastorage.org/r/w1560/webt/h5/iu/ub/h5iuubphfwaxivlpeavmoj3qowy.png 781w" loading="lazy" decode="async"/></p><br/>
<p>На каждой итерации SymCC пробирался чуть дальше внутрь программы и в итоге смог решить уравнение. Greybox бы такого не смог.</p></div>
                    </div><br/>
<h2 id="vnutrennosti-greybox-fazzerov">Внутренности Greybox-фаззеров</h2><br/>
<p>Пришло время вернуться к покрытию кода программы и оракулам багов. Какие их варианты использовать — это одно из множества решений, которые нужно принять разработчику или пользователю Greybox-фаззера. Сюда же можно отнести выбор механизма исполнения PUT и модели тест-кейсов.</p><br/>
<p>(Я остановлюсь на этих четырех аспектах для краткости — конечно, ими дело не ограничивается.)</p><br/>
<h3 id="pokrytie-koda-programmy">Покрытие кода программы</h3><br/>
<p>Как уже сказано выше, Greybox-фаззеры используют покрытие, чтобы понять, какие тест-кейсы полезны.</p><br/>
<p>Покрытие фаззер может понимать по-разному. Вот несколько типов, которые встречаются в доступных решениях:</p><br/>
<ol>
<li>Покрытие базовых блоков (Basic Block Coverage). Это самый примитивный способ измерения покрытия программы, потому что он игнорирует все связи между блоками.</li>
<li>Покрытие ветвей (Edge Coverage). В этом случае в качестве единицы покрытия рассматривается направленное ребро между базовыми блоками. Оно было введено фаззером AFL и быстро подтвердило свою эффективность: оказалось, что с его помощью можно быстрее обнаруживать интересные тест-кейсы.</li>
<li>Покрытие N-грам (N-gram coverage). При этом типе покрытия фаззер следит за последовательностью из нескольких блоков.</li>
<li>Контекстное покрытие. Здесь фаззер следит не просто за покрытыми базовыми блоками или ветвями, но и за тем, откуда была вызвана функция, в которой оказались пройдены данные блок или ветвь.</li>
</ol><br/>
<p>Во всех случаях при обнаружении нового покрытия фаззер добавляет тест-кейс в корпус.</p><br/>
<p>По умолчанию в большинстве современных фаззеров используется покрытие ветвей.</p><br/>
<h3 id="mehanizm-ispolneniya-put">Механизм исполнения PUT</h3><br/>
<p>Механизм исполнения влияет на быстродействие фаззера, то есть на количество тест-кейсов, которые фаззер успеет обработать за секунду.</p><br/>
<p>В самом примитивном варианте фаззер заново запускает программу на каждый тест-кейс.</p><br/>
<p>Но запуск — относительно долгий процесс: нужно выделить ресурсы, найти библиотеки, все это замапить. Для маленьких программ львиная доля системного времени, потраченного фаззером, будет приходиться на подготовку, а не на исполнение кода программы.</p><br/>
<p>Чтобы не терять время, предусмотрели три более сложных механизма:</p><br/>
<ol>
<li><p>Fork mode. Процесс запускают один раз, после чего для каждого тест-кейса делают форк процесса. Это позволяет пропустить инициализацию при каждом тест-кейсе, и подготовка занимает намного меньше времени, чем при создании все новых и новых процессов. </p><br/>
<p>Fork — самый простой способ ускориться, если приложение принимает данные из STDIN. Этот механизм встроен в фаззер AFL++. </p><br/>
</li>
<li><p>Fork mode ++ (название мое). Процесс запускается один раз, после чего делается форк и сохраняется содержимое всех страниц. Как только исполнение на тест-кейсе завершено, модуль проверяет, какие страницы надо восстановить, и заменяет только их. </p><br/>
<p>Этот механизм написали тоже для AFL++. Неудобство в том, что для его использования нужен <a href="https://github.com/AFLplusplus/AFL-Snapshot-LKM">специальный модуль ядра</a>, который следит, какие страницы были изменены (флаг Dirty в структурах пэйджинга). Зато этот способ быстрее Fork: со слов разработчиков модуля, прирост скорости составляет от 20 до 360% в зависимости от PUT. </p><br/>
</li>
<li><p>Persistent mode. Программа инициализируется, доходит до функции X, после чего эта функция исполняется в цикле с подменой аргументов. </p><br/>
<p>Это самый быстрый с точки зрения фаззинга способ, но у него есть свои минусы. Во-первых, обычно он требует множества модификаций PUT. Во-вторых, он может вызывать проблемы, так как отдельные исполнения перестают быть независимыми. В-третьих, он создает false positive: так как процесс не меняется, есть большой риск изменения состояния процесса и наведенных ошибок. Поэтому обычно цикл исполняется N-е количество раз, после чего либо создается новый форк процесса из оригинального состояния, либо процесс перезапускается. </p><br/>
<p>Persistent mode — основа работы фаззера libFuzzer, но его можно добавить и в AFL++ (<a href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/instrumentation/README.persistent_mode.md">в документации</a> все объясняется).</p><br/>
</li>
</ol><br/>
<h3 id="model-test-keysov">Модель тест-кейсов</h3><br/>
<p>Эта модель отвечает за то, как фаззер мутирует и воспринимает наши тест-кейсы.</p><br/>
<p>Основных вариантов два:</p><br/>
<ol>
<li>Фаззинг бинарных данных.</li>
<li>Фаззинг на основе предоставленной модели (Structure-Aware Fuzzing).</li>
</ol><br/>
<p><strong>При первом варианте</strong> фаззер воспринимает тест-кейсы просто как последовательность бинарных данных: не пытается парсить и изменять отдельные части (в 99% случаев), а случайным образом выбирает место и способ, которым нужно менять тест-кейс. В AFL этот метод был доведен до совершенства с точки зрения используемых мутаторов (но не способа их использования — впрочем, это тема следующей статьи).</p><br/>
<p>Проблема фаззинга бинарных данных в том, что большинство программ ожидают определенной структуры от вводимых данных, например:</p><br/>
<ol>
<li>Алфавит.</li>
<li>Набор фиксированных токенов.</li>
<li>Зависимости между токенами.</li>
<li>Наличие кусков (chunk) данных определенной структуры.</li>
</ol><br/>
<p>Каждое из таких ожиданий программы очень сильно снижает эффективность фаззера с бинарным представлением тест-кейсов. Представьте, что на старте программы стоит фильтр и лишь малый процент тест-кейсов его проходит и задевает внутреннюю логику, которая нам и интересна.</p><br/>
<p><strong>Второй вариант</strong> — фаззинг на основе предоставленной модели — гораздо более действенный, хотя и трудозатратный. При нем вы определяете структуру тест-кейсов, чтобы фаззер изменял их в соответствии с ней.</p><br/>
<p>Вот несколько форматов модели данных:</p><br/>
<ol>
<li><p>Форма, используемая в <a href="https://wiki.mozilla.org/Security/Fuzzing/Peach">Peach Fuzzer</a>. Останавливаться на ней мы не будем, потому что она не распространена. </p><br/>
</li>
<li><p>Расширенная форма Бэкуса-Наура (РБНФ/EBNF), которую, например, использует <a href="https://github.com/AFLplusplus/Grammar-Mutator/tree/b79d51a8daccbd7a693f9b6765c81ead14f28e26">грамматический мутатор AFL++</a>. Она наиболее удобна для тестирования текстовых форматов и протоколов, таких как SMTP. К примеру, здесь представлена сохраненная в JSON грамматика для JSON: </p><br/>
<pre><code class="json">{
"&lt;start&gt;": [["&lt;json&gt;"]],
"&lt;json&gt;": [["&lt;element&gt;"]],
"&lt;element&gt;": [["&lt;ws&gt;", "&lt;value&gt;", "&lt;ws&gt;"]],
"&lt;value&gt;": [["&lt;object&gt;"], ["&lt;array&gt;"], ["&lt;string&gt;"], ["&lt;number&gt;"],
            ["true"], ["false"],
            ["null"]],
"&lt;object&gt;": [["{", "&lt;ws&gt;", "}"], ["{", "&lt;members&gt;", "}"]],
"&lt;members&gt;": [["&lt;member&gt;", "&lt;symbol-2&gt;"]],
"&lt;member&gt;": [["&lt;ws&gt;", "&lt;string&gt;", "&lt;ws&gt;", ":", "&lt;element&gt;"]],
"&lt;array&gt;": [["[", "&lt;ws&gt;", "]"], ["[", "&lt;elements&gt;", "]"]],
"&lt;elements&gt;": [["&lt;element&gt;", "&lt;symbol-1-1&gt;"]],
"&lt;string&gt;": [["\"", "&lt;characters&gt;", "\""]],
"&lt;characters&gt;": [["&lt;character-1&gt;"]],
"&lt;character&gt;": [["0"], ["1"], ["2"], ["3"], ["4"], ["5"], ["6"], ["7"],
                ["8"], ["9"], ["a"], ["b"], ["c"], ["d"], ["e"], ["f"],
                ["g"], ["h"], ["i"], ["j"], ["k"], ["l"], ["m"], ["n"],
                ["o"], ["p"], ["q"], ["r"], ["s"], ["t"], ["u"], ["v"],
                ["w"], ["x"], ["y"], ["z"], ["A"], ["B"], ["C"], ["D"],
                ["E"], ["F"], ["G"], ["H"], ["I"], ["J"], ["K"], ["L"],
                ["M"], ["N"], ["O"], ["P"], ["Q"], ["R"], ["S"], ["T"],
                ["U"], ["V"], ["W"], ["X"], ["Y"], ["Z"], ["!"], ["#"],
                ["$"], ["%"], ["&amp;"], ["\""], ["("], [")"], ["*"], ["+"],
                [","], ["-"], ["."], ["/"], [":"], [";"], ["&lt;"], ["="],
                ["&gt;"], ["?"], ["@"], ["["], ["]"], ["^"], ["_"], ["`"],
                ["{"], ["|"], ["}"], ["~"], [" "], ["&lt;esc&gt;"], ["'"]],
"&lt;esc&gt;": [["\\","&lt;escc&gt;"]],
"&lt;escc&gt;": [["\\"],["b"],["f"], ["n"], ["r"],["t"],["\""]],
"&lt;number&gt;": [["&lt;int&gt;", "&lt;frac&gt;", "&lt;exp&gt;"]],
"&lt;int&gt;": [["&lt;digit&gt;"], ["&lt;onenine&gt;", "&lt;digits&gt;"], ["-", "&lt;digits&gt;"],
          ["-", "&lt;onenine&gt;", "&lt;digits&gt;"]],
"&lt;digits&gt;": [["&lt;digit-1&gt;"]],
"&lt;digit&gt;": [["0"], ["&lt;onenine&gt;"]],
"&lt;onenine&gt;": [["1"], ["2"], ["3"], ["4"], ["5"], ["6"], ["7"], ["8"],
              ["9"]],
"&lt;frac&gt;": [[], [".", "&lt;digits&gt;"]],
"&lt;exp&gt;": [[], ["E", "&lt;sign&gt;", "&lt;digits&gt;"], ["e", "&lt;sign&gt;", "&lt;digits&gt;"]],
"&lt;sign&gt;": [[], ["+"], ["-"]],
"&lt;ws&gt;": [["&lt;sp1&gt;", "&lt;ws&gt;"], []],
"&lt;sp1&gt;": [[" "],["\n"],["\t"],["\r"]],
"&lt;symbol&gt;": [[",", "&lt;members&gt;"]],
"&lt;symbol-1&gt;": [[",", "&lt;elements&gt;"]],
"&lt;symbol-2&gt;": [[], ["&lt;symbol&gt;", "&lt;symbol-2&gt;"]],
"&lt;symbol-1-1&gt;": [[], ["&lt;symbol-1&gt;", "&lt;symbol-1-1&gt;"]],
"&lt;character-1&gt;": [[], ["&lt;character&gt;", "&lt;character-1&gt;"]],
"&lt;digit-1&gt;": [["&lt;digit&gt;"], ["&lt;digit&gt;", "&lt;digit-1&gt;"]]
}</code></pre><br/>
<p>Проблема с РБНФ заключается в том, что это грамматика второго типа или бесконтекстная грамматика, из-за чего технически определять ей XML или HTML нельзя. И парсить их RegEx, кстати, <a href="https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454">тоже</a>. Пространство генерируемых ею тест-кейсов заведомо меньше пространства, определяемого данными форматами, что ограничивает сложные граничные случаи, которые могут быть сгенерированы РБНФ. Например, в этой модели мы не можем задать правило «если в тест-кейсе четное число букв <em>a</em>, то последней должна быть обязательно <em>b</em>», не скатившись в перебор всех возможных вариантов. </p><br/>
</li>
<li><p>Использование Protocol Buffers. Это удобный способ определить структуру файла или протокола: вы описываете их при помощи Protocol Buffers и пишете свой преобразователь из protobuf в бинарные данные. </p><br/>
<p>Существует специальная библиотека <a href="https://github.com/google/libprotobuf-mutator">libprotobuf-mutator</a>, которая позволяет использовать заготовленные мутаторы на внутренние типы и в целом сама мутирует protobuf-представление тест-кейса. С ее помощью можно с минимальным вложением сил получить достаточно умный мутатор (а если он и тупит, то документация подскажет, как легко добавить логику). </p><br/>
<p>Пример части определения для фаззинга парсера DNS-сообщений:</p><br/>
<pre><code class="go">syntax = "proto2";
package dnsmessage;
message Message{
required Header header = 1;
repeated Question question = 2;
repeated ResourceRecord answer = 3;
repeated ResourceRecord authority = 4;
repeated ResourceRecord additional = 5;
message Header{
    required int32 id = 1;
    required bool qr = 2;
    required Opcode opcode = 3;
    required bool aa = 4;
    required bool tc = 5;
    required bool rd = 6;
    required bool ra = 7;
    required bool ad = 8;
    required bool cd = 9;
    required RCode rcode = 10;
    required int32 qdcount = 11;
    required int32 ancount = 12;
    required int32 nscount = 13;
    required int32 arcount = 14;
}
...
}</code></pre><br/>
</li>
</ol><br/>
<h3 id="orakuly-bagov">Оракулы багов</h3><br/>
<p>Вот сравнительная таблица стандартных оракулов багов, которые есть в компиляторе Clang (его используют фаззеры под C/C++):</p><br/>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>Название оракула</th>
<th>Что детектирует</th>
<th>Потеря скорости</th>
<th>Примечание</th>
</tr>
</thead>
<tbody>
<tr>
<td>Address Sanitizer (ASAN)</td>
<td>Запись мимо выделенных буфферов, утечки памяти и тому подобное</td>
<td>В 2 раза</td>
<td>Содержит Leak Sanitizer</td>
</tr>
<tr>
<td>Undefined Behavior Sanitizer (UBSAN)</td>
<td>«Неопределенное поведение»: деления на ноль, целочисленные переполнения и пр.</td>
<td>В 1, 2 раза</td>
<td> </td>
</tr>
<tr>
<td>Memory Sanitizer (MSAN)</td>
<td>Чтение неинициализированной памяти</td>
<td>В 3 раза</td>
<td>Нельзя использовать с ASAN</td>
</tr>
<tr>
<td>Thread Sanitizer (TSAN)</td>
<td>Рейсы</td>
<td>В 5–15 раз</td>
<td> </td>
</tr>
</tbody>
</table></div><br/>
<p>Чтобы было понятно, как оракулы работают, приведу пример с ASAN — он мне кажется наиболее полезным для обнаружения эксплуатабельных багов.</p><br/>
<p>Допустим, у нас есть программа с возможностью чтения за границей выделенного буфера:</p><br/>
<pre><code class="cpp">#include &lt;stdio.h&gt;

int main(){
    int size, pick;
    unsigned char* array;
    printf("Pick malloc size: ");
    scanf("%d",&amp;size);
    array=calloc(size,1);
    printf("Read from element: ");
    scanf("%d",&amp;pick);
    printf("Result: %x\n",array[pick]);
    free(array);
    return 0;
}</code></pre><br/>
<p>Если скомпилировать программу с ASAN, он покажет чтение элемента за границей:</p><br/>
<p><img src="https://habrastorage.org/webt/av/na/us/avnausmdvvsd525jpbjdacjqr4y.gif" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/webt/av/na/us/avnausmdvvsd525jpbjdacjqr4y.gif 780w,&#10;       https://habrastorage.org/webt/av/na/us/avnausmdvvsd525jpbjdacjqr4y.gif 781w" loading="lazy" decode="async"/></p><br/>
<br/>
<h2 id="osnovnye-semeystva-greybox-fazzerov-dlya-cc">Основные семейства Greybox-фаззеров для C/C++</h2><br/>
<p>Мне кажется, что стоит упомянуть три семейства (хотя вы можете со мной не согласиться). Вот они:</p><br/>
<ul>
<li>AFL;</li>
<li>LibFuzzer;</li>
<li>Honggfuzz.</li>
</ul><br/>
<p><strong>AFL</strong> — это фаззер, который дал толчок в массовому использованию Greybox-фазз-тестирования, когда Michal Zalewski (lcamtuf) выпустил его в 2013 году. Базовая идея фаззера была такой: собираем покрытие ветвей при каждом исполнении, цель — максимизировать покрытие.</p><br/>
<p>Сейчас «ванильный» AFL уже не используется, но от него отпочковалось много проектов, например WinAFL и TinyAFL, которые позволяю проводить фаззинг приложений на Windows при помощи бинарной инструментации. Самый популярный и быстроразвивающийся проект я уже называл выше: это AFLPlusPlus (AFL++). Он вбирает в себя новые техники и постоянно расширяет возможности исследователей.</p><br/>
<p>AFL и AFL++ достаточно просты, чтобы их мог использовать новичок, но придется немного почитать документацию.</p><br/>
<p><strong>LibFuzzer</strong> распространяется вместе с Clang. Он эволюционирует не так быстро, как AFL++, но там тоже есть встроенные приятные фичи (например, <a href="https://mboehme.github.io/paper/FSE20.Entropy.pdf">алгоритм entropic</a>, который выбирает наиболее эффективные тест-кейсы из корпуса).</p><br/>
<p>Этот фаззер рассчитан только на использование в persistent mode. Однако на случай, если приложение отжирает слишком много памяти, у него есть и fork mode: он форкает процесс для небольшого числа итераций в persistent mode, после чего прибивает его.</p><br/>
<p>Использовать libFuzzer очень легко.</p><br/>
<p><strong>Honggfuzz</strong> отличается методами сбора покрытия: фаззер позволяет использовать Intel Branch Trace Store или Intel Processor Trace. Также в нем есть есть стандартная возможность инструментировать приложение во время компиляции и поддержка фаззинга скомпилированных приложений при помощи qemu mode (хотя это есть и у AFL++).</p><br/>
<p>Легко ли его использовать, сказать не могу: я обходился AFL++ и libFuzzer. Так как собственного опыта работы с honggfuzz у меня нет, дальше в статье я его не касаюсь.</p><br/>
<p>А вот libFuzzer и AFL++ давайте рассмотрим подробнее.<br/>
<br/>
</p><br/>
<h3 id="libfuzzer-na-praktike">LibFuzzer на практике</h3><br/>
<p>Давайте попробуем написать простой обвяз (harness) для фаззинга с libFuzzer.</p><br/>
<p>Установите себе Clang, если он еще не поставлен (<a href="https://clang.llvm.org/get_started.html" title="https://clang.llvm.org/get_started.html">инструкция</a>). Скопируйте следующий код в basic_example.c:</p><br/>
<pre><code class="cpp">#include &lt;stddef.h&gt;
#include &lt;stdint.h&gt;

int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) {
    if (size &gt; 0 &amp;&amp; data[0] == 'H')
        if (size &gt; 1 &amp;&amp; data[1] == 'I')
            if (size &gt; 3 &amp;&amp; data[2] == '!')
            __builtin_trap();
    return 0;
}
</code></pre><br/>
<p>В качестве входа, в который будут подаваться тест-кейсы, в libFuzzer используется следующая функция:</p><br/>
<pre><code class="cpp">int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size)</code></pre><br/>
<p>На вход передается тест-кейс и его размер. Если возвращаемое значение не равно нулю, то фаззер воспринимает это как обнаруженный баг. Так легко добавлять обнаружение нарушений логики приложения. Если что-то не соответствует ожиданиям, достаточно вернуть не ноль.</p><br/>
<p>В libFuzzer еще определена такая стандартная функция:</p><br/>
<pre><code class="cpp">int LLVMFuzzerInitialize(int *argc, char ***argv)</code></pre><br/>
<p>В нее передаются указатели на аргументы запуска фаззера. Вообще функция нужна не только чтобы изменять их, если они используются внутри программы, но и чтобы произвести всю необходимую инициализацию. Поскольку в нашем примере нет никаких глобальных переменных, мы обошлись без этой функции.</p><br/>
<p>Скомпилируем наш обвяз:</p><br/>
<pre><code class="bash">clang -fsanitize=fuzzer basic_example.c -o basic_example</code></pre><br/>
<p>Если бы мы хотели добавить ASAN и UBSAN, то нужно было бы компилировать так:</p><br/>
<pre><code class="bash">clang -fsanitize=fuzzer,address,undefined basic_example.c -o basic_example</code></pre><br/>
<p>Clang сам добавит все необходимое для persistent mode.</p><br/>
<p>Сейчас мы запустим фаззер без каких-либо параметров. В реальном исследовании так делать не стоит: можно потерять много времени впустую из-за пропавших тест-кейсов. Но мы просто хотим проверить игрушечный пример, поэтому запускаем:</p><br/>
<p><img src="https://habrastorage.org/webt/a1/wi/cg/a1wicg-krx1u7cyoo9ycflpq_ry.gif" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/webt/a1/wi/cg/a1wicg-krx1u7cyoo9ycflpq_ry.gif 780w,&#10;       https://habrastorage.org/webt/a1/wi/cg/a1wicg-krx1u7cyoo9ycflpq_ry.gif 781w" loading="lazy" decode="async"/></p><br/>
<p>Фаззер тут же находит тест-кейс (его можно заметить на видео в конце снизу — «H!HH»), который вызывает прерывание. Тест-кейс сохранен под именем crash-&lt;хеш от содержимого&gt;. Его можно снова передать в исследуемое приложение, чтобы посмотреть стек вызовов:</p><br/>
<p><img src="https://habrastorage.org/webt/da/7w/g3/da7wg3ueknjfpfa-qmhgao5w4rc.gif" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/webt/da/7w/g3/da7wg3ueknjfpfa-qmhgao5w4rc.gif 780w,&#10;       https://habrastorage.org/webt/da/7w/g3/da7wg3ueknjfpfa-qmhgao5w4rc.gif 781w" loading="lazy" decode="async"/><br/>
<br/>
</p><br/>
<h3 id="a-teper-afl">А теперь AFL++</h3><br/>
<p>Если исходники уже подготовлены к использованию с libFuzzer, то переделать их под работу с AFL++ в persistent mode тривиально. Достаточно скачать <a href="https://chromium.googlesource.com/chromium/llvm-project/compiler-rt/lib/fuzzer.git/+/HEAD/afl/afl_driver.cpp">afl_driver.cpp</a>, который распространяется в составе LLVM, и скомпилировать под AFL++.</p><br/>
<ol>
<li><p>Качаем, собираем и устанавливаем <a href="https://github.com/AFLplusplus/AFLplusplus">AFL++</a>.</p><br/>
</li>
<li><p>Компилируем basic_example.c, afl_driver.cpp и линкуем:</p><br/>
<pre><code class="plaintext">afl-clang-fast -c basic_example.c
afl-clang-fast++ -c afl_driver.cpp
afl-clang-fast++ basic_example.o afl_driver.o -o basic_afl_example</code></pre><br/>
</li>
<li><p>Создаем директории, кладем какой-нибудь файл в input и запускаем:</p><br/>
<pre><code class="bash">mkdir input output; echo "" &gt; input/0;
afl-fuzz -i input -o output -- ./afl_basic_example</code></pre><br/>
</li>
<li><div class="oembed"><div class="tm-iframe_temp" data-src="https://embedd.srv.habr.com/iframe/6102aceff2fa57a26f179fb8" data-style="" id="6102aceff2fa57a26f179fb8" width=""></div></div><br/>
<p>Как видно, AFL++ тоже находит прерывание, но в базовой конфигурации делает это медленнее libFuzzer.</p><br/>
</li>
</ol><br/>
<h3 id="krutizna-afl-i-mutacii">Крутизна AFL и мутации</h3><br/>
<p>Я упоминал, что именно AFL привел к взрыву исследований и разработки в области фаззинга. Но почему именно AFL?</p><br/>
<p>Это был первый фаззер, который сочетал одновременно несколько особенностей:</p><br/>
<ol>
<li>Его было просто использовать. В случаях с вводом по stdin достаточно было заменить компиляторы GCC/Clang на afl-gcc или afl-clang. (Это не значит, что GCC надо заменять на afl-gcc, а Clang на afl-clang. Если хотите этим заняться, посмотрите <a href="https://github.com/AFLplusplus/AFLplusplus/blob/stable/README.md">документацию AFL++</a> и выберите компилятор, который встроит самую быструю инструментацию, доступную вам.)</li>
<li>Он использовал покрытие ветвей, которое оказалось эффективнее для фаззинга, чем покрытие блоков.</li>
<li>Он составлял расписание тест-кейсов (schedule) так, чтобы медленные тест-кейсы не отъедали слишком много времени. Расписание фаззера — это алгоритм решения, какие тест-кейсы из корпуса фаззер выбирает на каждом этапе и сколько времени он выделяет на тестирование их мутированных версий. AFL строит очередь из всех тест-кейсов в корпусе, причем при постановке в очередь приоритет отдает новым тест-кейсам. Также AFL настраивает количество запусков PUT с мутированными тест-кейсами, увеличивая или уменьшая его в зависимости от времени выполнения базового тест-кейса, который мутирует в данный момент. Иначе при обнаружении особенно медленного экземпляра ему бы выделялось больше всего времени.</li>
<li>Он содержал механизмы мутаций и извлечения информации из тест-кейсов, предоставленных в начальном корпусе, которые Michal Zalewski проверил на эффективность опытным путем.</li>
</ol><br/>
<p>О последней особенности — механизмах мутации — надо рассказать подробнее.</p><br/>
<p>Мутации — это еще одна составляющая фаззинга, наравне с покрытием, механизмом исполнения PUT, моделью тест-кейсов и оракулами. Есть две основные фазы мутаций:</p><br/>
<ol>
<li>Детерминистическая.</li>
<li>Хаос (Havoc).</li>
</ol><br/>
<p>В конфигурации по умолчанию AFL начинает <strong>с детерминистической фазы.</strong> Для каждого тест-кейса в стартовом корпусе AFL последовательно применяет следующие мутации (после каждой мутации проверяет PUT с данным тест-кейсом):</p><br/>
<ol>
<li>Флип одного бита в тест-кейсе (0x00 → 0x80).</li>
<li>Флип последовательной пары битов (0x00 → 0xC0).</li>
<li>Флип последовательной четверки битов (0x00 → 0xF0).</li>
<li>Инвертирование байта (0x00 → 0xFF).</li>
<li>Инвертирование двух последовательных байтов (0x0000 → 0xFFFF).</li>
<li>Инвертирование четырёх последовательных байтов (0x00000000 → 0xFFFFFFFF).</li>
<li>Добавление и вычитание из байтов, вордов и двордов малых значений (и в little-endian, и в big-endian).</li>
<li>Замена байтов, вордов, двордов на особые значения (1, −1, 0, 127 и пр.).</li>
</ol><br/>
<p>Такие мутации с высокой вероятности изменят работу PUT, если там производится обработка бинарных данных.</p><br/>
<p>При этом AFL анализирует поведение программы при осуществлении отдельных битфлипов. Например, AFL видит, что работа PUT при флипе 0-го бита меняется, с 0–31 она изменена, а когда флип производится на 32 бите, все возвращается к прежней работе. В этом случае AFL понимает, что, скорее всего, в этих четырех байтах находится <abbr title="Фиксированная константа, определяющая тип файла">MAGIC</abbr> или другая константа, запоминает ее и добавляет в словарь, который потом использует на хаотической фазе. Это делает его крайне эффективным: если собран большой корпус файлов, которые должна обрабатывать PUT, то AFL с большой вероятностью сможет создать интересную комбинацию из частей известных тест-кейсов.</p><br/>
<p>Когда AFL заканчивает детерминистическую фазу (или сразу, если пользователь ее пропускает), то переходит <strong>в хаотическую фазу.</strong> В этой фазе есть две стратегии:</p><br/>
<ul>
<li>просто хаос;</li>
<li>хаос со сплайсингом.</li>
</ul><br/>
<p>Первая стратегия — просто хаос — одновременно использует несколько мутаций на одном тест-кейсе (не обязательно все сразу):</p><br/>
<ol>
<li>Одиночные битфлипы.</li>
<li>Подстановка особых значений.</li>
<li>Добавление и вычитание малых значений.</li>
<li>Замена отдельных байтов случайными значениями.</li>
<li>Удаление блоков байтов.</li>
<li>Замена и вставка блоков байтов.</li>
<li>Замена блока блоком из одинаковых байтов.</li>
</ol><br/>
<p>Вторая стратегия — хаос со сплайсингом — делает так:</p><br/>
<ol>
<li>Берет пару тест-кейсов, которые отличаются как минимум в двух местах.</li>
<li>Разрывает каждый из них.</li>
<li>Склеивает разные части.</li>
<li>Применяет первую стратегию к результату.</li>
</ol><br/>
<p>Вторая стратегия пытается скомбинировать характеристики двух тест-кейсов, чтобы удовлетворить одновременно несколько условиям в парсере.<br/>
<br/>
</p><br/>
<h2 id="esche-ne-konec">Еще не конец</h2><br/>
<p>Фух, долгое и мучительное введение в то, как работает фаззер, закончилось.</p><br/>
<p>В следующей статье я расскажу, как улучшались стандартные механизмы фаззеров, чтобы становиться более эффективными.</p></div></div></div><!----><!----></div><!----><!----></div><!--]--><!----><div class="tm-article-presenter__meta" data-test-id="article-meta-links"><div class="tm-separated-list tag-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D1%83%D1%8F%D0%B7%D0%B2%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8]" class="tm-tags-list__link"><span>уязвимости</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D1%84%D0%B0%D0%B7%D0%B7%D0%B8%D0%BD%D0%B3]" class="tm-tags-list__link"><span>фаззинг</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5+%D0%BF%D0%BE]" class="tm-tags-list__link"><span>тестирование по</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F+%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C]" class="tm-tags-list__link"><span>информационная безопасность</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%B2%D0%B7%D0%BB%D0%BE%D0%BC]" class="tm-tags-list__link"><span>взлом</span></a><!--]--></li><!--]--><!----></ul></div><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/companies/bizone/articles/" class="tm-hubs-list__link"><!--[--><span>Блог компании BI.ZONE</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/infosecurity/" class="tm-hubs-list__link"><!--[--><span>Информационная безопасность</span><!--]--></a><!--]--></li><!--]--><!----></ul></div></div><!----><!--]--></article><!--]--></div><!----></div><div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel"><div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons"><div class="article-rating tm-data-icons__item" data-v-86aec4a7><div class="tm-votes-meter votes-switcher" data-v-86aec4a7><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 9: ↑9 и ↓0</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-rating"></use></svg><span class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating tm-votes-meter__value" data-test-id="votes-meter-value" title="Всего голосов 9: ↑9 и ↓0">+9</span></div><!--teleport start--><!--teleport end--><!----></div><!----><!----><button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">37</span></button><div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button><!--teleport start--><!--teleport end--></div><div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a href="/ru/companies/bizone/articles/570312/comments/" class="tm-article-comments-counter-link__link" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value">6</span><!--]--></a><!----></div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!----></div></div></div><!--[--><!--]--><div class="tm-article-presenter__footer"><!--[--><!--[--><div class="tm-article-blocks"><!----><!--[--><section class="tm-block tm-block tm-block_spacing-bottom"><!----><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><!--[--><div class="tm-article-author" data-test-id="article-author-info" data-async-called="true"><!--[--><!--[--><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/companies/bizone/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="40" src="//habrastorage.org/getpro/habr/company/606/14d/823/60614d8230f985b3acdf792bbfe88d35.png" width="40"></div></a><div class="tm-company-snippet__info"><a href="/ru/companies/bizone/profile/" class="tm-company-snippet__title" data-test-id="company-title"><span>BI.ZONE</span></a><div class="tm-company-snippet__description">Компания</div></div></div><div class="tm-article-author__buttons"><!----><!----></div></div><div class="tm-article-author__company-contacts"><!--[--><a class="tm-article-author__contact" href="https://bi.zone/" rel="noopener" target="_blank">Сайт</a><a class="tm-article-author__contact" href="https://x.com/bizone_en" rel="noopener" target="_blank">X</a><a class="tm-article-author__contact" href="https://telegram.me/bizone_channel" rel="noopener" target="_blank">Telegram</a><!--]--></div><div class="tm-article-author__separator"></div></div><!--]--><!--]--><div class="tm-user-card tm-user-card tm-user-card_variant-article tm-article-author__user-card" data-async-called="true"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/BiZone_team/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" src="//habrastorage.org/getpro/habr/avatars/f4e/26e/0ff/f4e26e0ffc7aac66add13ccce18c9880.png"></div></a><div class="tm-user-card__meta"><div class="tm-counter-container karma" title=" 88 голосов " data-v-f7c0e283><div class="tm-counter-container__header"><!--[--><div class="karma-display positive" data-v-f7c0e283 data-v-7635202e>66</div><!----><!--]--></div><div class="tm-counter-container__footer"><!--[--><div class="karma-text" data-v-f7c0e283>Карма</div><!--teleport start--><!--teleport end--><!--]--></div></div><div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"><!--[--><!--[--><!--]--><div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----><div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score"><!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">4</span></span><!--]--></div><!----></div><!--]--></div><div class="tm-counter-container__footer"><!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]--></div></div></div></div></div><div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info"><div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title"><span class="tm-user-card__name tm-user-card__name_variant-article tm-user-card__name">BI.ZONE</span><a href="/ru/users/BiZone_team/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"> @BiZone_team</a><!----></div><p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Пользователь</p></div></div><!----><div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons"><!----><div class="tm-user-card__button"><div class="tm-button-follow tm-user-card__button-follow"><!----><button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button></div></div><!----><div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations"><svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16"><title>Отправить сообщение</title><use xlink:href="/img/megazord-v28.7909a852..svg#mail"></use></svg></div><!----></div><!----></div><div class="tm-article-author__user-contacts" data-test-id="author-contacts"><!----><!----><!--[--><a class="tm-article-author__contact" data-test-id="author-contact-link" href="https://bi.zone/" rel="noopener" target="_blank">Сайт</a><a class="tm-article-author__contact" data-test-id="author-contact-link" href="https://facebook.com/bi.zone.rus" rel="noopener" target="_blank">Facebook</a><a class="tm-article-author__contact" data-test-id="author-contact-link" href="https://telegram.me/bizone_channel" rel="noopener" target="_blank">Telegram</a><!--]--></div></div><!--]--></div><!--]--><!----></section><!----><!--[--><div class="banner-wrapper leaderboard tm-company-article__banner" style="--38f3d936:200px;--78a3cd06:auto;" data-v-f4bf0d24><!--[--><div class="placeholder-wrapper placeholder" data-v-f4bf0d24><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder leaderboard" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div><!----><!----><!----></div><div id="adfox_164725660339535756" class="tm-adfox-banner" data-v-f4bf0d24></div><!--]--></div><!----><!--]--><!--]--><div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div data-async-called="true" data-server-rendered="true"><div class="tm-article-comments" data-test-id="article-comments"><div class="tm-comments-wrapper"><div class="tm-comments-wrapper__wrapper"><header class="tm-comments-wrapper__header"><h2 class="tm-comments-wrapper__title">Комментарии <span class="tm-comments-wrapper__comments-count">6</span></h2><div class="tm-comments-wrapper__header-aside"><!--[--><!--[--><!----><button class="tm-rss-button tm-rss-button_comments-header"><span class="tm-svg-icon__wrapper tm-rss-button__icon"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Скопировать ссылку на RSS</title><use xlink:href="/img/megazord-v28.7909a852..svg#rss"></use></svg></span></button><!----><!--]--><!--]--></div></header><div class="tm-comments-wrapper__inner"><!--[--><!--[--><!--[--><!--]--><!----><div class="tm-comments__tree" data-comments-list><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_23327768" class="tm-comment-thread__target" name="comment_23327768"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="23327768"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/bret99/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="bret99"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/144.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/bret99/" class="tm-user-info__username">bret99 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_23327768"><time datetime="2021-08-02T13:26:18.000Z" title="2021-08-02, 16:26">2  авг  2021 в 16:26</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Dirbuster брутит директории в web application. К слову. Аналогия с фаззингом С++ applications имхо такая себе.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="23327768"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_23327770" class="tm-comment-thread__target" name="comment_23327770"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="23327770"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/BiZone_team/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="BiZone_team"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/f4e/26e/0ff/f4e26e0ffc7aac66add13ccce18c9880.png" width="24"></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/BiZone_team/" class="tm-user-info__username">BiZone_team <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_23327770"><time datetime="2021-08-02T13:26:46.000Z" title="2021-08-02, 16:26">2  авг  2021 в 16:26</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Да, этот пример «на грани». По сути мы ищем раскрытие информации при помощи проверенного списка путей. Конечно, это очень отличается от Greybox-фаззинга приложений, но Blackbox часто работает именно так.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="23327770"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_23328608" class="tm-comment-thread__target" name="comment_23328608"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-0"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-0" data-comment-body="23328608"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/vilgeforce/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="vilgeforce"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/063.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/vilgeforce/" class="tm-user-info__username">vilgeforce <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_23328608"><time datetime="2021-08-02T16:40:04.000Z" title="2021-08-02, 19:40">2  авг  2021 в 19:40</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><!----><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Не первый раз читаю про фаззинг и возникает вопрос: все эти инструменты могут работать с уже имеющимся исполняемым файлом? Например я хочу пофаззить word.exe из MS Office ;-)</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="23328608"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_23329038" class="tm-comment-thread__target" name="comment_23329038"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-1"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-1" data-comment-body="23329038"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Rumata888/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Rumata888"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/187.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Rumata888/" class="tm-user-info__username">Rumata888 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_23329038"><time datetime="2021-08-02T19:12:26.000Z" title="2021-08-02, 22:12">2  авг  2021 в 22:12</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>В случае бинарного фаззинга всё немного сложнее, взять инструмент, чтобы он сразу заработал, в большинстве случаев не получится. Под Windows можно использовать WinAFL, TinyAFL, Jackalope, есть и другие варианты. Но придется реверсить. Да и MS Office тяжелый таргет. Ну и в случае исполняемых файлов не получается сделать такие же хорошие оракулы багов. Например, слежение за кучей начинает использовать намного больше памяти, а детектировать неправильное чтение буфера на стеке очень сложно, ведь нет информации о границах переменных.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="23329038"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_23329042" class="tm-comment-thread__target" name="comment_23329042"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-2"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-2" data-comment-body="23329042"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/vilgeforce/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="vilgeforce"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/063.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/vilgeforce/" class="tm-user-info__username">vilgeforce <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_23329042"><time datetime="2021-08-02T19:15:41.000Z" title="2021-08-02, 22:15">2  авг  2021 в 22:15</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Как признак бага в оракуле можно было бы использовать необработанные исключения? Я, когда делал свой "фаззер" делал именно так, но ни о каком "умном" изменении входных данных и тем более о покрытии кода и речи там не шло. А хотелось бы чего-то более эффективного...</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="23329042"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><div style="" class="tm-comment-thread__children"><!--[--><section class="tm-comment-thread"><!----><article class="tm-comment-thread__comment"><a id="comment_23330652" class="tm-comment-thread__target" name="comment_23330652"></a><button class="tm-comment-thread__breadcrumbs tm-comment-thread__indent_b_l-3"><div class="tm-comment-thread__circle"></div></button><!----><div class="tm-comment-thread__indent_l-3" data-comment-body="23330652"><div class="tm-comment" data-gallery-root popup-toggle-visible="false"><header class="tm-comment__header" data-comment-header tabindex="-1"><div class="tm-comment__header-inner"><span class="tm-user-info tm-comment__user-info"><a href="/ru/users/Rumata888/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Rumata888"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="24" src="https://assets.habr.com/habr-web/img/avatars/187.png" width="24"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Rumata888/" class="tm-user-info__username">Rumata888 <!----></a><!--[--><!--[--><!--[--><a class="tm-comment-thread__comment-link" href="#comment_23330652"><time datetime="2021-08-03T09:23:53.000Z" title="2021-08-03, 12:23">3  авг  2021 в 12:23</time><!----></a><!--]--><!--]--><!--]--></span></span></div><div class="tm-comment__buttons"><button class="tm-comment__button tm-comment__button_with-icon" type="button"><svg class="tm-svg-img tm-comment__icon" height="16" width="16"><title>Показать предыдущий комментарий</title><use xlink:href="/img/megazord-v28.7909a852..svg#small-arrow"></use></svg></button><!----></div></header><div class="tm-comment__body-content_v2 tm-comment__body-content" style=""><div xmlns="http://www.w3.org/1999/xhtml"><p>Да, необработанные исключения - это оракул багов, который есть в каждой программе. Проблема в том, что он очень слабый. Например, есть такая уязвимость off-by-one. Когда программа промахивается и записывает на один байт больше, чем надо. Например, неправильно посчитали, куда на ставить ноль в строке в C. Поскольку у кучи есть определенная гранулярность, то в большинстве случаев такая перезапись не затронет какие-либо метаданные. Только неиспользуемый кусок выделенного чанка. Оракулы багов нужны, чтобы сразу обнаруживать такие проблемы, потому что и они иногда приводят к эксплуатации. В Windows для этого включают специальную кучу.</p><p>Если хотите попробовать пофаззить какой-то исполняемый файл на Windows, попробуйте <a href="https://github.com/linhlhq/TinyAFL" rel="noopener noreferrer nofollow">https://github.com/linhlhq/TinyAFL</a> или <a href="https://github.com/googleprojectzero/Jackalope" rel="noopener noreferrer nofollow">https://github.com/googleprojectzero/Jackalope</a> . Но лучше начать с чего-то попроще Word.</p></div></div><!----><!----></div><!--[--><div class="tm-comment-footer"><!--[--><svg class="tm-svg-img" height="18" width="32"><title>Рейтинг скрыт</title><use xlink:href="/img/megazord-v28.7909a852..svg#votes-fallback"></use></svg><!--[--><button class="tm-comment-thread__button" type="button">Ответить</button><!--]--><button class="bookmarks-button tm-comment-footer__button tm-comment-footer__button_with-icon" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use></svg></span><!----></button><!--]--><button class="tm-comment__button tm-comment__button_with-icon" data-comment-popup="23330652"><svg class="tm-svg-img tm-comment__icon tm-comment__icon_dots" height="16" width="16"><title>Ещё</title><use xlink:href="/img/megazord-v28.7909a852..svg#dots"></use></svg></button><!----></div><!--]--></div></article><!----><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!----></section><!--]--></div><!--[--><!--]--><!--]--><!----><!--teleport start--><!--teleport end--><!--]--></div></div><!--[--><div class="tm-notice tm-notice_positive tm-comments__comment-notice"><!----><div class="tm-notice__inner"><!----><div class="tm-notice__content" data-test-id="notice-content"><!--[--><a href="/kek/v1/auth/habrahabr/?back=/ru/companies/bizone/articles/570312/&amp;hl=ru" rel="nofollow">Зарегистрируйтесь на Хабре</a><span>, чтобы оставить комментарий</span><!--]--></div></div></div><!--]--></div></div></div></div></div><!--[--><!--[--><!--]--><section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><!--[--><!--[--><div class="tm-tabs tm-tabs"><div class=""><!--[--><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim tm-tabs__tab-link">Лучшие за сутки</button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_slim tm-tabs__tab-link">Похожие</button></span><!--]--></div><!----></div><div class="similar-and-daily__tab-view"><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-article-cards"><!--[--><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><!--]--></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!----></div><!--]--><!--]--></div><!--]--><!----></section><!--[--><!--[--><div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-promo"><div class="tm-placeholder-promo__header"><div class="tm-placeholder__line tm-placeholder__line_promo-title"></div></div><div class="tm-placeholder-promo__body"><div class="tm-placeholder-promo__posts"><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div></div><div class="tm-placeholder-promo__dots"><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-inset tm-placeholder-salary"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div><div class="tm-placeholder-salary__body"><div class="tm-placeholder-salary__text"><div class="tm-placeholder__line tm-placeholder__line_salary_average"></div><div class="tm-placeholder-salary__description"><div class="tm-placeholder__line loads"></div><div class="tm-placeholder__line loads"></div><div class="tm-placeholder__line loads"></div><div class="tm-placeholder__line loads"></div></div></div><div class="tm-placeholder-salary__image loads"></div></div><div class="tm-placeholder-inset__footer tm-placeholder-inset__footer_salary"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><!--]--><!--]--><!----><!--[--><!--]--><!--]--></div><!--]--><!--]--></div></div><!--]--><!--]--></div></div><div class="tm-page__sidebar"><!--[--><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__placeholder_initial"></div><div class="tm-sexy-sidebar_initial tm-sexy-sidebar" style="margin-top:0px;"><!--[--><!--]--><!----><div class="tm-layout-sidebar__ads_initial tm-layout-sidebar__ads"><div class="banner-wrapper half-page tm-layout-sidebar__banner tm-layout-sidebar__banner_top" style="--38f3d936:600px;--78a3cd06:auto;" data-v-f4bf0d24><!--[--><div class="placeholder-wrapper placeholder" data-v-f4bf0d24><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder half-page" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div><!----><!----><!----></div><div id="adfox_164725680533065327" class="tm-adfox-banner" data-v-f4bf0d24></div><!--]--></div></div><!--[--><section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Информация</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body"><!--[--><div class="tm-company-basic-info"><dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">Сайт</dt><dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body"><!--[--><a class="tm-company-basic-info__link" href="https://bi.zone/" target="_blank">bi.zone</a><!--]--></dd></dl><dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">Дата регистрации</dt><dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body"><!--[--><time datetime="2016-11-11T09:46:52.000Z" title="2016-11-11, 12:46">11  ноября  2016</time><!--]--></dd></dl><!----><dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">Численность</dt><dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body"><!--[-->501–1 000 человек<!--]--></dd></dl><dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap"><dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">Местоположение</dt><dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body"><!--[-->Россия<!--]--></dd></dl><!----></div><!--]--></div><!--]--><!----></section><div class="tm-company-widgets"><!--[--><!--]--></div><!----><div></div><!--]--><div class="banner-wrapper medium-rectangle tm-layout-sidebar__banner tm-layout-sidebar__banner_bottom" style="--38f3d936:250px;--78a3cd06:auto;" data-v-f4bf0d24><!--[--><div class="placeholder-wrapper placeholder" data-v-f4bf0d24><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder medium-rectangle" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div><!----><!----><!----></div><div id="adfox_164725691003361602" class="tm-adfox-banner" data-v-f4bf0d24></div><!--]--></div></div></div><!--]--></div></div><!----><!--]--></div></div></main><!----></div><div class="tm-footer-menu"><div class="tm-page-width"><!--[--><div class="tm-footer-menu__container"><!--[--><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Ваш аккаунт</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/companies/bizone/articles/570312/&amp;hl=ru" rel="nofollow" target="_self">Войти</a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/companies/bizone/articles/570312/&amp;hl=ru" rel="nofollow" target="_self">Регистрация</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Разделы</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/articles/" class="footer-menu__item-link">Статьи</a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">Новости</a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">Хабы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">Компании</a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">Авторы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">Песочница</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Информация</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">Устройство сайта</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">Для авторов</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">Для компаний</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">Документы</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement/?hl=ru_RU" target="_blank">Соглашение</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/?hl=ru_RU" target="_blank">Конфиденциальность</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Услуги</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/corporate-blogs/" target="_blank">Корпоративный блог</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/advertising/" target="_blank">Медийная реклама</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/native-special/" target="_blank">Нативные проекты</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/education-programs/" target="_blank">Образовательные программы</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/hello-startup/" target="_blank">Стартапам</a></li><!--]--></ul></div></div><!--]--></div><!--]--></div></div><div class="tm-footer"><div class="tm-page-width"><!--[--><div class="tm-footer__container"><!----><div class="tm-footer__social"><!--[--><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Facebook</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Twitter</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>VK</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Telegram</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Youtube</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Яндекс Дзен</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a><!--]--></div><!--teleport start--><!--teleport end--><button class="tm-footer__link"><!----> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a><div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2025, </span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div><!--]--></div></div><!----><!--]--></div><!----></div><script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"570312":{"id":"570312","timePublished":"2021-08-02T09:13:04+00:00","isCorporative":true,"lang":"ru","titleHtml":"Немного про современные технологии Greybox-фаззинга","leadData":{"textHtml":"\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fjr\u002Fea\u002Fj-\u002Fjreaj-lia98n2khuvvh8ifghau0.jpeg\"\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EАвтор: \u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Frumata888\" rel=\"nofollow noopener noreferrer\"\u003EИннокентий Сенновский\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Ch2 id=\"kak-nayti-bagi-o-kotoryh-vy-i-ne-dogadyvalis-ili-chto-takoe-fazzing\"\u003EКак найти баги, о которых вы и не догадывались, или что такое фаззинг\u003C\u002Fh2\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВсе уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема: разработчик может защититься только от багов, которые он способен предугадать. Да и тестировщик вряд ли сможет перебрать все варианты входных данных, которые приводят к ошибке.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EЧтобы справиться с этой проблемой, придумали фаззеры — инструменты тестирования, которые сами пытаются найти баги в программе. В этой статье я рассмотрю, какие они вообще бывают (для C\u002FC++, потому что баги в таких программах особенно болезненны), но сделаю упор на Greybox-фаззеры (почему, расскажу в статье).\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Обожаю статьи, где много букв","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1670291","alias":"BiZone_team","fullname":"BI.ZONE","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff4e\u002F26e\u002F0ff\u002Ff4e26e0ffc7aac66add13ccce18c9880.png","speciality":"Пользователь","scoreStats":{"score":66,"votesCount":88},"rating":4,"relatedData":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fbi.zone\u002F","value":"https:\u002F\u002Fbi.zone\u002F","siteTitle":null,"favicon":null},{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002Fbi.zone.rus","value":"bi.zone.rus","siteTitle":null,"favicon":null},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fbizone_channel","value":"bizone_channel","siteTitle":null,"favicon":null}],"authorContacts":[{"title":"Сайт","url":"https:\u002F\u002Fbi.zone\u002F","value":"https:\u002F\u002Fbi.zone\u002F","siteTitle":null,"favicon":null},{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002Fbi.zone.rus","value":"bi.zone.rus","siteTitle":null,"favicon":null},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fbizone_channel","value":"bizone_channel","siteTitle":null,"favicon":null}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null,"isInBlacklist":null,"careerProfile":null},"statistics":{"commentsCount":6,"favoritesCount":37,"readingCount":8770,"score":9,"votesCount":9,"votesCountPlus":9,"votesCountMinus":0},"hubs":[{"id":"20894","alias":"bizone","type":"corporative","title":"Блог компании BI.ZONE","titleHtml":"Блог компании BI.ZONE","isProfiled":false,"relatedData":null},{"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true,"relatedData":null}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fjr\u002Fea\u002Fj-\u002Fjreaj-lia98n2khuvvh8ifghau0.jpeg\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fwebt\u002Fjr\u002Fea\u002Fj-\u002Fjreaj-lia98n2khuvvh8ifghau0.jpeg 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fjr\u002Fea\u002Fj-\u002Fjreaj-lia98n2khuvvh8ifghau0.jpeg 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EАвтор: \u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Frumata888\"\u003EИннокентий Сенновский\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"kak-nayti-bagi-o-kotoryh-vy-i-ne-dogadyvalis-ili-chto-takoe-fazzing\"\u003EКак найти баги, о которых вы и не догадывались, или что такое фаззинг\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВсе уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема: разработчик может защититься только от багов, которые он способен предугадать. Да и тестировщик вряд ли сможет перебрать все варианты входных данных, которые приводят к ошибке.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧтобы справиться с этой проблемой, придумали фаззеры — инструменты тестирования, которые сами пытаются найти баги в программе. В этой статье я рассмотрю, какие они вообще бывают (для C\u002FC++, потому что баги в таких программах особенно болезненны), но сделаю упор на Greybox-фаззеры (почему, расскажу в статье).\u003C\u002Fp\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EРечь пойдет не об инструментах пентестеров, вроде Dirbuster или Burp Suite, которые проверяют программы на типичные проблемы и затрагивают лишь поверхность, а о фаззерах вроде AFL и LibFuzzer, которые тестируют программу, руководствуясь ее внутренним строением и механизмами.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch2 id=\"chto-takoe-fazzer\"\u003EЧто такое фаззер\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДавайте начнем с того, что такое собственно фаззинг.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДопустим, у нас есть программа, которую мы хотим протестировать. Будем называть ее на заморский манер — PUT (Program Under Test).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ академической среде \u003Cem\u003Eфаззинг\u003C\u002Fem\u003E — это когда мы исполняем PUT с использованием входных данных, которые расширяют входное пространство PUT. Если по-простому, то пытаемся найти данные, которые выявят новую функциональность в программе.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНо в сфере кибербезопасности под фаззингом обычно подразумевают \u003Cem\u003Eфазз-тестирование\u003C\u002Fem\u003E. Это когда мы используем фаззинг, чтобы проверить, что PUT не нарушает какую-либо политику безопасности. То есть мы смотрим, существуют ли данные, при которых поведение программы может сделать больно разработчику.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cem\u003EФаззер\u003C\u002Fem\u003E, как следует из названия, это инструмент для проведения фаззинга. Его общий алгоритм можно высокоуровнево представить так:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef FuzzTesting (Corpus, Tlimit):\n    BugsFound = set()\n    Corpus = Preprocess(Corpus)\n    while (Telapsed &lt; Tlimit) and Continue(Corpus):\n        configuration = Schedule(Corpus,Telapsed, Tlimit)\n        testcases = InputGen(configuration)\n        Bugs_new, execinfos = InputEval(configuration, testcases, BugOracle)\n        Corpus = ConfUpdate(Corpus, Configuration, execinfos)\n        BugsFound.add(Bugs_new)\n    return (Corpus,BugsFound)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСразу поясню две сущности, которые могли показаться непонятными:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cul\u003E\n\u003Cli\u003ECorpus (seed pool, корпус) — набор используемых фаззером входных данных, или тест-кейсов. Обычно фазз-тестирование запускают не на пустом корпусе. Если тестируют какую-то функцию, то сначала собирают образцы данных, которые подаются в нее при нормальной работе. Допустим, тестируя парсер изображений, подготавливают набор самых разных файлов, которые он должен обрабатывать. Это позволяет быстрее добраться до интересной функциональности и не тратить время на прохождение скучных проверок, таких как сигнатуры файлов.\u003C\u002Fli\u003E\n\u003Cli\u003EBug Oracle (оракул багов) — программа или модуль, которые детектируют нарушение политики безопасности, например опасные обращения к памяти или запись файла не туда. К оракулам багов я еще вернусь дальше в статье.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EТаким образом, фаззер:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EОбрабатывает начальные тест-кейсы, создавая корпус.\u003C\u002Fli\u003E\n\u003Cli\u003EВходит в цикл фаззинга, который продолжается, пока не закончится время или не сработает некое условие.\u003C\u002Fli\u003E\n\u003Cli\u003EВнутри цикла генерирует конфигурацию, а из нее — новые тест-кейсы.\u003C\u002Fli\u003E\n\u003Cli\u003EОбрабатывает эти тест-кейсы, получает баги и информацию об исполнении.\u003C\u002Fli\u003E\n\u003Cli\u003EНа основе информации об исполнении расширяет корпус и добавляет баги.\u003C\u002Fli\u003E\n\u003Cli\u003EПосле окончания фаззинга выдает корпус и найденные баги.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch2 id=\"vidy-fazzinga\"\u003EВиды фаззинга\u003C\u002Fh2\u003E\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОсновных видов фаззинга — три:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EBlackbox.\u003C\u002Fli\u003E\n\u003Cli\u003EWhitebox.\u003C\u002Fli\u003E\n\u003Cli\u003EGreybox.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ каждой статье должна быть хоть одна кринжовая картинка. Вот она:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fry\u002Fbx\u002F6c\u002Frybx6cexi52bk_t8jqats6nzb7m.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fwebt\u002Fry\u002Fbx\u002F6c\u002Frybx6cexi52bk_t8jqats6nzb7m.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fry\u002Fbx\u002F6c\u002Frybx6cexi52bk_t8jqats6nzb7m.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EBlackbox\u003C\u002Fstrong\u003E — самый примитивный вариант (инструменты — Burp Suite, DirBuster, Radamsa и др.). Обычно с их помощью пытаются найти типичные баги или баги в крайне дырявых программах. В этом случае информация об исполнении, которую фаззер получает при обращении к программе с указанным тест-кейсом, ограничена выводом программы или фактом ее отказа. Поэтому для большинства таких программ очень важны изначальные тест-кейсы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EWhitebox\u003C\u002Fstrong\u003E — самый тяжелый вариант (инструменты — KLEE и подобные). У него есть три самых явных подвида:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cp\u003ESymbolic Execution (символическое, оно же символьное, исполнение). При нем вместо преобразования кода программы в исполняемый код компилятор выплевывает набор формул, который описывает всю работу программы. Далее специальный решатель (обычно это SMT-решатель вроде \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FZ3Prover\u002Fz3\"\u003Ez3\u003C\u002Fa\u003E) преобразует \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSatisfiability_modulo_theories\"\u003ESMT\u003C\u002Fa\u003E в \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FBoolean_satisfiability_problem\"\u003ESAT\u003C\u002Fa\u003E и пытается найти определенные пространства решений. Формулы модифицируются таким образом, чтобы пройти каждую ветвь исполнения изначальной программы. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли вы хотите поиграться с таким фаззером, воспользуйтесь старым и проверенным \u003Ca href=\"https:\u002F\u002Fklee.github.io\u002F\"\u003EKLEE\u003C\u002Fa\u003E или более новым и, на мой взгляд, простым \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Feurecom-s3\u002Fsymcc\"\u003ESymCC\u003C\u002Fa\u003E. Последний очень советую, если надо протестировать маленькую программу для парсинга файлов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EУ всех машин для символического исполнения есть одна проблема: в общем случае решение SAT, к которому в итоге приводятся программы, является NP-полной задачей. SMT-решатели находят решения за счет крайне эффективного упрощения теорем на каждом этапе, но чем больше программа и чем глубже в нее надо проникнуть, тем менее вероятно, что решатель справится за приемлемое время. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EConcolic Execution (конколическое исполнение). Это попытка немного упростить символическое исполнение за счет обогащения решателя данными от реального исполнения программы. Выполнили программу на известном тест-кейсе → сохранили данные → запустили решать попадание на другую ветвь с полученной информацией. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EData Taint Tracking (термин на русском я не встречал). Это самый легкий с точки зрения вычислений метод, который относят к Whitebox-фаззингу. При исполнении программы все байты, которые зависят от определенных байтов входных данных, помечаются (taint). За счет этого фаззер отслеживает, что влияет на выбор пути исполнения, данные на какой позиции нужно менять.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EBlackbox туповат, Whitebox неэффективен для сложных программ и ест много ресурсов, поэтому придумали нечто среднее.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EGreybox\u003C\u002Fstrong\u003E — это фаззинг, при котором каждый раз, когда PUT исполняет тест-кейс, фаззер получает не только информацию о выводе и падении программы (зачастую вывод вообще игнорируется), но и информацию о ходе исполнения программы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ общем случае информация может быть любой, но обычно используют такую метрику, как \u003Cem\u003Eпокрытие кода программы\u003C\u002Fem\u003E. Под этим подразумевают то, какие части программы были исполнены. Например, если рассмотреть программу как граф, покрытие может быть списком вершин, которые были пройдены при исполнении. Но может быть и чем-то другим — о видах покрытия я расскажу чуть позже.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПокрытие программы используется как лакмусовая бумажка, чтобы определить, надо ли добавлять тест-кейс в корпус или он бесполезен. Если исполнение PUT достигает новой части программы (например, изменяет условие в каком-то if), то фаззер детектирует это событие и добавляет тест-кейс в корпус. Таким образом покрытие программы расширяется и вероятность обнаружения какой-то проблемы увеличивается.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДальше в статье я сосредоточусь именно на Greybox как на самом эффективном виде фазз-тестирования.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EНо есть случаи, когда обычный Greybox-фаззер уступает символическому исполнению\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cp\u003EВозьмем код, который требует решение системы линейных алгебраических уравнений на трех переменных:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\nint main(int argc, char* argv[]) {\n    int coeffs[]={10, 2 , -3, 5, 6, 7, -11, 4, 0};\n    int results[]={49, 70, -39};\n    printf(\"What's the solution to the following system of  equations?\\n\");\n    for (int i=0; i&lt;3; i++){\n        printf(\"%d*x0 \",coeffs[i*3]);\n        for (int j=1; j&lt;3; j++){\n            int curCoeff=coeffs[i*3+j];\n            if ( curCoeff &lt; 0){\n                printf(\"- %d*x%d \",abs(curCoeff),j);\n            } else if (curCoeff &gt; 0){\n                printf(\"+ %d*x%d \",curCoeff,j);\n            }\n        }\n        printf(\"= %d;\\n\",results[i]);\n    }\n    int solution[3];\n    ssize_t result;\n    printf(\"Reading %lu bytes for x1, x2, x3:\\n\",sizeof(int)*3);\n    for (int i = 0; i&lt;3; i++)\n    {\n        if(read(STDIN_FILENO,&amp;solution[i],sizeof(int))!=sizeof(int)){\n            printf (\"Error reading\\n\");\n            return -1;\n        }\n    }\n    int success=1;\n    for (int i = 0; i &lt; 3; i++){\n        int accumulator=0;\n        for (int j =0; j &lt; 3; j++) {\n            accumulator+=coeffs[i*3+j]*solution[j];\n        }\n        if (accumulator!=results[i]){\n            success=0;\n            break;\n        }\n    }\n    if (success)\n        printf(\"Hooray!!!\\n\");\n    else\n        printf(\"Goodbye, DumDum\\n\");\n    return 0;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВот как сработает программа, если мы подадим на вход числа, которые не удовлетворяют системе уравнений :\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fzg\u002Fii\u002F_5\u002Fzgii_5b35x5dz85awo9qqzxdzk0.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fwebt\u002Fzg\u002Fii\u002F_5\u002Fzgii_5b35x5dz85awo9qqzxdzk0.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fzg\u002Fii\u002F_5\u002Fzgii_5b35x5dz85awo9qqzxdzk0.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E(Да, у меня немного поехала нумерация переменных в принтах, но, когда выпускали статью, переделывать картинки уже было поздно.)\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли скомпилировать эту программу, вероятность попадания Greybox-фаззера в точку будет \u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fformulas\u002F0ba\u002F8fc\u002F59b\u002F0ba8fc59bafc5603168abebe244053a2.svg\" alt=\"$\\frac{1}{2^{96}}$\" data-tex=\"inline\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fformulas\u002F0ba\u002F8fc\u002F59b\u002F0ba8fc59bafc5603168abebe244053a2.svg 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fformulas\u002F0ba\u002F8fc\u002F59b\u002F0ba8fc59bafc5603168abebe244053a2.svg 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E ​(размер int на системе — 4 байта).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EА теперь давайте попробуем найти решение при помощи \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Feurecom-s3\u002Fsymcc\"\u003EWhitebox-фаззера SymCC\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКлонируем SymCC. Собираем контейнер (так намного проще, чем устанавливать все зависимости и собирать компилятор на своей системе). Запускаем контейнер и пробрасываем папку с файлом (находимся в ней):\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Edocker run --name=symcc_container -v $(pwd):\u002Fbuild_dir -it --rm symcc\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКомпилируем:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Esymcc symcc_example.c -o symcc_example\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЗаодно на хосте можно скомпилировать без символического исполнения, чтобы проверить результат позже:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Eclang symcc_example.c -o symmcc_example_nosym\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСоздадим несколько папок для результатов и пример ввода:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Emkdir output\u002F{1,2,3,4};\necho -n \"TESTTESTTEST\" &gt; first_input;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНесколько папок нужно, потому что на каждом запуске SymCC перезаписывает файлы в папке вывода. Если мы не хотим потерять предыдущие результаты, то лучше сохранять результаты в отдельные папки.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EАлгоритм работы SymCC достаточно прост:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EОн исполняет скомпилированное приложение с предоставленным вводом, параллельно создавая символические правила.\u003C\u002Fli\u003E\n\u003Cli\u003EДля каждого ветвления (if, while и др.) SymCC пытается поменять исполнение данной ветви на альтернативное, инвертировав условие.\u003C\u002Fli\u003E\n\u003Cli\u003ESymCC пытается решить полученный набор теорем и выплевывает такой ввод, который приводит к выбранному графу исполнения, если фаззер смог его найти.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EИз-за такого принципа работы использовать SymCC напрямую в качестве фаззера не очень удобно. Нужен какой-нибудь хэндлер (он есть в AFL++), чтобы проверять, найдена ли новая функциональность, и подавать на вход только те тест-кейсы, которые открыли новые ветви. В нашем случае программа очень простая и не содержит много ветвей, так что мы можем проделать этот путь вручную.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЗапустим с начальным тест-кейсом:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fwz\u002Fx9\u002Fd9\u002Fwzx9d93q5x_3ox47vzbqpbgyqo0.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fwebt\u002Fwz\u002Fx9\u002Fd9\u002Fwzx9d93q5x_3ox47vzbqpbgyqo0.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fwz\u002Fx9\u002Fd9\u002Fwzx9d93q5x_3ox47vzbqpbgyqo0.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003ESymCC показывает вывод программы при исполнении ее с заданным тест-кейсом, а также информацию о затраченном на решение времени и полученных новых тест-кейсах.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДавайте сразу отправим новый тест-кейс снова в SymCC:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fuo\u002F7l\u002F3q\u002Fuo7l3qqa7nseayv8do93sqbds5y.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fwebt\u002Fuo\u002F7l\u002F3q\u002Fuo7l3qqa7nseayv8do93sqbds5y.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fuo\u002F7l\u002F3q\u002Fuo7l3qqa7nseayv8do93sqbds5y.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПолучили три тест-кейса. Последний и есть решение уравнения:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fh5\u002Fiu\u002Fub\u002Fh5iuubphfwaxivlpeavmoj3qowy.png\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fwebt\u002Fh5\u002Fiu\u002Fub\u002Fh5iuubphfwaxivlpeavmoj3qowy.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fh5\u002Fiu\u002Fub\u002Fh5iuubphfwaxivlpeavmoj3qowy.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНа каждой итерации SymCC пробирался чуть дальше внутрь программы и в итоге смог решить уравнение. Greybox бы такого не смог.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"vnutrennosti-greybox-fazzerov\"\u003EВнутренности Greybox-фаззеров\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПришло время вернуться к покрытию кода программы и оракулам багов. Какие их варианты использовать — это одно из множества решений, которые нужно принять разработчику или пользователю Greybox-фаззера. Сюда же можно отнести выбор механизма исполнения PUT и модели тест-кейсов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E(Я остановлюсь на этих четырех аспектах для краткости — конечно, ими дело не ограничивается.)\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch3 id=\"pokrytie-koda-programmy\"\u003EПокрытие кода программы\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКак уже сказано выше, Greybox-фаззеры используют покрытие, чтобы понять, какие тест-кейсы полезны.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПокрытие фаззер может понимать по-разному. Вот несколько типов, которые встречаются в доступных решениях:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EПокрытие базовых блоков (Basic Block Coverage). Это самый примитивный способ измерения покрытия программы, потому что он игнорирует все связи между блоками.\u003C\u002Fli\u003E\n\u003Cli\u003EПокрытие ветвей (Edge Coverage). В этом случае в качестве единицы покрытия рассматривается направленное ребро между базовыми блоками. Оно было введено фаззером AFL и быстро подтвердило свою эффективность: оказалось, что с его помощью можно быстрее обнаруживать интересные тест-кейсы.\u003C\u002Fli\u003E\n\u003Cli\u003EПокрытие N-грам (N-gram coverage). При этом типе покрытия фаззер следит за последовательностью из нескольких блоков.\u003C\u002Fli\u003E\n\u003Cli\u003EКонтекстное покрытие. Здесь фаззер следит не просто за покрытыми базовыми блоками или ветвями, но и за тем, откуда была вызвана функция, в которой оказались пройдены данные блок или ветвь.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВо всех случаях при обнаружении нового покрытия фаззер добавляет тест-кейс в корпус.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПо умолчанию в большинстве современных фаззеров используется покрытие ветвей.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch3 id=\"mehanizm-ispolneniya-put\"\u003EМеханизм исполнения PUT\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EМеханизм исполнения влияет на быстродействие фаззера, то есть на количество тест-кейсов, которые фаззер успеет обработать за секунду.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ самом примитивном варианте фаззер заново запускает программу на каждый тест-кейс.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНо запуск — относительно долгий процесс: нужно выделить ресурсы, найти библиотеки, все это замапить. Для маленьких программ львиная доля системного времени, потраченного фаззером, будет приходиться на подготовку, а не на исполнение кода программы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧтобы не терять время, предусмотрели три более сложных механизма:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cp\u003EFork mode. Процесс запускают один раз, после чего для каждого тест-кейса делают форк процесса. Это позволяет пропустить инициализацию при каждом тест-кейсе, и подготовка занимает намного меньше времени, чем при создании все новых и новых процессов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EFork — самый простой способ ускориться, если приложение принимает данные из STDIN. Этот механизм встроен в фаззер AFL++. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EFork mode ++ (название мое). Процесс запускается один раз, после чего делается форк и сохраняется содержимое всех страниц. Как только исполнение на тест-кейсе завершено, модуль проверяет, какие страницы надо восстановить, и заменяет только их. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭтот механизм написали тоже для AFL++. Неудобство в том, что для его использования нужен \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAFLplusplus\u002FAFL-Snapshot-LKM\"\u003Eспециальный модуль ядра\u003C\u002Fa\u003E, который следит, какие страницы были изменены (флаг Dirty в структурах пэйджинга). Зато этот способ быстрее Fork: со слов разработчиков модуля, прирост скорости составляет от 20 до 360% в зависимости от PUT. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EPersistent mode. Программа инициализируется, доходит до функции X, после чего эта функция исполняется в цикле с подменой аргументов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭто самый быстрый с точки зрения фаззинга способ, но у него есть свои минусы. Во-первых, обычно он требует множества модификаций PUT. Во-вторых, он может вызывать проблемы, так как отдельные исполнения перестают быть независимыми. В-третьих, он создает false positive: так как процесс не меняется, есть большой риск изменения состояния процесса и наведенных ошибок. Поэтому обычно цикл исполняется N-е количество раз, после чего либо создается новый форк процесса из оригинального состояния, либо процесс перезапускается. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EPersistent mode — основа работы фаззера libFuzzer, но его можно добавить и в AFL++ (\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAFLplusplus\u002FAFLplusplus\u002Fblob\u002Fstable\u002Finstrumentation\u002FREADME.persistent_mode.md\"\u003Eв документации\u003C\u002Fa\u003E все объясняется).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Ch3 id=\"model-test-keysov\"\u003EМодель тест-кейсов\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭта модель отвечает за то, как фаззер мутирует и воспринимает наши тест-кейсы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОсновных вариантов два:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EФаззинг бинарных данных.\u003C\u002Fli\u003E\n\u003Cli\u003EФаззинг на основе предоставленной модели (Structure-Aware Fuzzing).\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EПри первом варианте\u003C\u002Fstrong\u003E фаззер воспринимает тест-кейсы просто как последовательность бинарных данных: не пытается парсить и изменять отдельные части (в 99% случаев), а случайным образом выбирает место и способ, которым нужно менять тест-кейс. В AFL этот метод был доведен до совершенства с точки зрения используемых мутаторов (но не способа их использования — впрочем, это тема следующей статьи).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПроблема фаззинга бинарных данных в том, что большинство программ ожидают определенной структуры от вводимых данных, например:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EАлфавит.\u003C\u002Fli\u003E\n\u003Cli\u003EНабор фиксированных токенов.\u003C\u002Fli\u003E\n\u003Cli\u003EЗависимости между токенами.\u003C\u002Fli\u003E\n\u003Cli\u003EНаличие кусков (chunk) данных определенной структуры.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКаждое из таких ожиданий программы очень сильно снижает эффективность фаззера с бинарным представлением тест-кейсов. Представьте, что на старте программы стоит фильтр и лишь малый процент тест-кейсов его проходит и задевает внутреннюю логику, которая нам и интересна.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EВторой вариант\u003C\u002Fstrong\u003E — фаззинг на основе предоставленной модели — гораздо более действенный, хотя и трудозатратный. При нем вы определяете структуру тест-кейсов, чтобы фаззер изменял их в соответствии с ней.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВот несколько форматов модели данных:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cp\u003EФорма, используемая в \u003Ca href=\"https:\u002F\u002Fwiki.mozilla.org\u002FSecurity\u002FFuzzing\u002FPeach\"\u003EPeach Fuzzer\u003C\u002Fa\u003E. Останавливаться на ней мы не будем, потому что она не распространена. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EРасширенная форма Бэкуса-Наура (РБНФ\u002FEBNF), которую, например, использует \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAFLplusplus\u002FGrammar-Mutator\u002Ftree\u002Fb79d51a8daccbd7a693f9b6765c81ead14f28e26\"\u003Eграмматический мутатор AFL++\u003C\u002Fa\u003E. Она наиболее удобна для тестирования текстовых форматов и протоколов, таких как SMTP. К примеру, здесь представлена сохраненная в JSON грамматика для JSON: \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n\"&lt;start&gt;\": [[\"&lt;json&gt;\"]],\n\"&lt;json&gt;\": [[\"&lt;element&gt;\"]],\n\"&lt;element&gt;\": [[\"&lt;ws&gt;\", \"&lt;value&gt;\", \"&lt;ws&gt;\"]],\n\"&lt;value&gt;\": [[\"&lt;object&gt;\"], [\"&lt;array&gt;\"], [\"&lt;string&gt;\"], [\"&lt;number&gt;\"],\n            [\"true\"], [\"false\"],\n            [\"null\"]],\n\"&lt;object&gt;\": [[\"{\", \"&lt;ws&gt;\", \"}\"], [\"{\", \"&lt;members&gt;\", \"}\"]],\n\"&lt;members&gt;\": [[\"&lt;member&gt;\", \"&lt;symbol-2&gt;\"]],\n\"&lt;member&gt;\": [[\"&lt;ws&gt;\", \"&lt;string&gt;\", \"&lt;ws&gt;\", \":\", \"&lt;element&gt;\"]],\n\"&lt;array&gt;\": [[\"[\", \"&lt;ws&gt;\", \"]\"], [\"[\", \"&lt;elements&gt;\", \"]\"]],\n\"&lt;elements&gt;\": [[\"&lt;element&gt;\", \"&lt;symbol-1-1&gt;\"]],\n\"&lt;string&gt;\": [[\"\\\"\", \"&lt;characters&gt;\", \"\\\"\"]],\n\"&lt;characters&gt;\": [[\"&lt;character-1&gt;\"]],\n\"&lt;character&gt;\": [[\"0\"], [\"1\"], [\"2\"], [\"3\"], [\"4\"], [\"5\"], [\"6\"], [\"7\"],\n                [\"8\"], [\"9\"], [\"a\"], [\"b\"], [\"c\"], [\"d\"], [\"e\"], [\"f\"],\n                [\"g\"], [\"h\"], [\"i\"], [\"j\"], [\"k\"], [\"l\"], [\"m\"], [\"n\"],\n                [\"o\"], [\"p\"], [\"q\"], [\"r\"], [\"s\"], [\"t\"], [\"u\"], [\"v\"],\n                [\"w\"], [\"x\"], [\"y\"], [\"z\"], [\"A\"], [\"B\"], [\"C\"], [\"D\"],\n                [\"E\"], [\"F\"], [\"G\"], [\"H\"], [\"I\"], [\"J\"], [\"K\"], [\"L\"],\n                [\"M\"], [\"N\"], [\"O\"], [\"P\"], [\"Q\"], [\"R\"], [\"S\"], [\"T\"],\n                [\"U\"], [\"V\"], [\"W\"], [\"X\"], [\"Y\"], [\"Z\"], [\"!\"], [\"#\"],\n                [\"$\"], [\"%\"], [\"&amp;\"], [\"\\\"\"], [\"(\"], [\")\"], [\"*\"], [\"+\"],\n                [\",\"], [\"-\"], [\".\"], [\"\u002F\"], [\":\"], [\";\"], [\"&lt;\"], [\"=\"],\n                [\"&gt;\"], [\"?\"], [\"@\"], [\"[\"], [\"]\"], [\"^\"], [\"_\"], [\"`\"],\n                [\"{\"], [\"|\"], [\"}\"], [\"~\"], [\" \"], [\"&lt;esc&gt;\"], [\"'\"]],\n\"&lt;esc&gt;\": [[\"\\\\\",\"&lt;escc&gt;\"]],\n\"&lt;escc&gt;\": [[\"\\\\\"],[\"b\"],[\"f\"], [\"n\"], [\"r\"],[\"t\"],[\"\\\"\"]],\n\"&lt;number&gt;\": [[\"&lt;int&gt;\", \"&lt;frac&gt;\", \"&lt;exp&gt;\"]],\n\"&lt;int&gt;\": [[\"&lt;digit&gt;\"], [\"&lt;onenine&gt;\", \"&lt;digits&gt;\"], [\"-\", \"&lt;digits&gt;\"],\n          [\"-\", \"&lt;onenine&gt;\", \"&lt;digits&gt;\"]],\n\"&lt;digits&gt;\": [[\"&lt;digit-1&gt;\"]],\n\"&lt;digit&gt;\": [[\"0\"], [\"&lt;onenine&gt;\"]],\n\"&lt;onenine&gt;\": [[\"1\"], [\"2\"], [\"3\"], [\"4\"], [\"5\"], [\"6\"], [\"7\"], [\"8\"],\n              [\"9\"]],\n\"&lt;frac&gt;\": [[], [\".\", \"&lt;digits&gt;\"]],\n\"&lt;exp&gt;\": [[], [\"E\", \"&lt;sign&gt;\", \"&lt;digits&gt;\"], [\"e\", \"&lt;sign&gt;\", \"&lt;digits&gt;\"]],\n\"&lt;sign&gt;\": [[], [\"+\"], [\"-\"]],\n\"&lt;ws&gt;\": [[\"&lt;sp1&gt;\", \"&lt;ws&gt;\"], []],\n\"&lt;sp1&gt;\": [[\" \"],[\"\\n\"],[\"\\t\"],[\"\\r\"]],\n\"&lt;symbol&gt;\": [[\",\", \"&lt;members&gt;\"]],\n\"&lt;symbol-1&gt;\": [[\",\", \"&lt;elements&gt;\"]],\n\"&lt;symbol-2&gt;\": [[], [\"&lt;symbol&gt;\", \"&lt;symbol-2&gt;\"]],\n\"&lt;symbol-1-1&gt;\": [[], [\"&lt;symbol-1&gt;\", \"&lt;symbol-1-1&gt;\"]],\n\"&lt;character-1&gt;\": [[], [\"&lt;character&gt;\", \"&lt;character-1&gt;\"]],\n\"&lt;digit-1&gt;\": [[\"&lt;digit&gt;\"], [\"&lt;digit&gt;\", \"&lt;digit-1&gt;\"]]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПроблема с РБНФ заключается в том, что это грамматика второго типа или бесконтекстная грамматика, из-за чего технически определять ей XML или HTML нельзя. И парсить их RegEx, кстати, \u003Ca href=\"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F1732348\u002Fregex-match-open-tags-except-xhtml-self-contained-tags\u002F1732454#1732454\"\u003Eтоже\u003C\u002Fa\u003E. Пространство генерируемых ею тест-кейсов заведомо меньше пространства, определяемого данными форматами, что ограничивает сложные граничные случаи, которые могут быть сгенерированы РБНФ. Например, в этой модели мы не можем задать правило «если в тест-кейсе четное число букв \u003Cem\u003Ea\u003C\u002Fem\u003E, то последней должна быть обязательно \u003Cem\u003Eb\u003C\u002Fem\u003E», не скатившись в перебор всех возможных вариантов. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EИспользование Protocol Buffers. Это удобный способ определить структуру файла или протокола: вы описываете их при помощи Protocol Buffers и пишете свой преобразователь из protobuf в бинарные данные. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСуществует специальная библиотека \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgoogle\u002Flibprotobuf-mutator\"\u003Elibprotobuf-mutator\u003C\u002Fa\u003E, которая позволяет использовать заготовленные мутаторы на внутренние типы и в целом сама мутирует protobuf-представление тест-кейса. С ее помощью можно с минимальным вложением сил получить достаточно умный мутатор (а если он и тупит, то документация подскажет, как легко добавить логику). \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПример части определения для фаззинга парсера DNS-сообщений:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"go\"\u003Esyntax = \"proto2\";\npackage dnsmessage;\nmessage Message{\nrequired Header header = 1;\nrepeated Question question = 2;\nrepeated ResourceRecord answer = 3;\nrepeated ResourceRecord authority = 4;\nrepeated ResourceRecord additional = 5;\nmessage Header{\n    required int32 id = 1;\n    required bool qr = 2;\n    required Opcode opcode = 3;\n    required bool aa = 4;\n    required bool tc = 5;\n    required bool rd = 6;\n    required bool ra = 7;\n    required bool ad = 8;\n    required bool cd = 9;\n    required RCode rcode = 10;\n    required int32 qdcount = 11;\n    required int32 ancount = 12;\n    required int32 nscount = 13;\n    required int32 arcount = 14;\n}\n...\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Ch3 id=\"orakuly-bagov\"\u003EОракулы багов\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВот сравнительная таблица стандартных оракулов багов, которые есть в компиляторе Clang (его используют фаззеры под C\u002FC++):\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cdiv class=\"scrollable-table\"\u003E\u003Ctable\u003E\n\u003Cthead\u003E\n\u003Ctr\u003E\n\u003Cth\u003EНазвание оракула\u003C\u002Fth\u003E\n\u003Cth\u003EЧто детектирует\u003C\u002Fth\u003E\n\u003Cth\u003EПотеря скорости\u003C\u002Fth\u003E\n\u003Cth\u003EПримечание\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody\u003E\n\u003Ctr\u003E\n\u003Ctd\u003EAddress Sanitizer (ASAN)\u003C\u002Ftd\u003E\n\u003Ctd\u003EЗапись мимо выделенных буфферов, утечки памяти и тому подобное\u003C\u002Ftd\u003E\n\u003Ctd\u003EВ 2 раза\u003C\u002Ftd\u003E\n\u003Ctd\u003EСодержит Leak Sanitizer\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003EUndefined Behavior Sanitizer (UBSAN)\u003C\u002Ftd\u003E\n\u003Ctd\u003E«Неопределенное поведение»: деления на ноль, целочисленные переполнения и пр.\u003C\u002Ftd\u003E\n\u003Ctd\u003EВ 1, 2 раза\u003C\u002Ftd\u003E\n\u003Ctd\u003E \u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003EMemory Sanitizer (MSAN)\u003C\u002Ftd\u003E\n\u003Ctd\u003EЧтение неинициализированной памяти\u003C\u002Ftd\u003E\n\u003Ctd\u003EВ 3 раза\u003C\u002Ftd\u003E\n\u003Ctd\u003EНельзя использовать с ASAN\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003EThread Sanitizer (TSAN)\u003C\u002Ftd\u003E\n\u003Ctd\u003EРейсы\u003C\u002Ftd\u003E\n\u003Ctd\u003EВ 5–15 раз\u003C\u002Ftd\u003E\n\u003Ctd\u003E \u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧтобы было понятно, как оракулы работают, приведу пример с ASAN — он мне кажется наиболее полезным для обнаружения эксплуатабельных багов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДопустим, у нас есть программа с возможностью чтения за границей выделенного буфера:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#include &lt;stdio.h&gt;\n\nint main(){\n    int size, pick;\n    unsigned char* array;\n    printf(\"Pick malloc size: \");\n    scanf(\"%d\",&amp;size);\n    array=calloc(size,1);\n    printf(\"Read from element: \");\n    scanf(\"%d\",&amp;pick);\n    printf(\"Result: %x\\n\",array[pick]);\n    free(array);\n    return 0;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли скомпилировать программу с ASAN, он покажет чтение элемента за границей:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fav\u002Fna\u002Fus\u002Favnausmdvvsd525jpbjdacjqr4y.gif\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fav\u002Fna\u002Fus\u002Favnausmdvvsd525jpbjdacjqr4y.gif 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fav\u002Fna\u002Fus\u002Favnausmdvvsd525jpbjdacjqr4y.gif 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003Ch2 id=\"osnovnye-semeystva-greybox-fazzerov-dlya-cc\"\u003EОсновные семейства Greybox-фаззеров для C\u002FC++\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EМне кажется, что стоит упомянуть три семейства (хотя вы можете со мной не согласиться). Вот они:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cul\u003E\n\u003Cli\u003EAFL;\u003C\u002Fli\u003E\n\u003Cli\u003ELibFuzzer;\u003C\u002Fli\u003E\n\u003Cli\u003EHonggfuzz.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EAFL\u003C\u002Fstrong\u003E — это фаззер, который дал толчок в массовому использованию Greybox-фазз-тестирования, когда Michal Zalewski (lcamtuf) выпустил его в 2013 году. Базовая идея фаззера была такой: собираем покрытие ветвей при каждом исполнении, цель — максимизировать покрытие.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСейчас «ванильный» AFL уже не используется, но от него отпочковалось много проектов, например WinAFL и TinyAFL, которые позволяю проводить фаззинг приложений на Windows при помощи бинарной инструментации. Самый популярный и быстроразвивающийся проект я уже называл выше: это AFLPlusPlus (AFL++). Он вбирает в себя новые техники и постоянно расширяет возможности исследователей.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EAFL и AFL++ достаточно просты, чтобы их мог использовать новичок, но придется немного почитать документацию.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003ELibFuzzer\u003C\u002Fstrong\u003E распространяется вместе с Clang. Он эволюционирует не так быстро, как AFL++, но там тоже есть встроенные приятные фичи (например, \u003Ca href=\"https:\u002F\u002Fmboehme.github.io\u002Fpaper\u002FFSE20.Entropy.pdf\"\u003Eалгоритм entropic\u003C\u002Fa\u003E, который выбирает наиболее эффективные тест-кейсы из корпуса).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭтот фаззер рассчитан только на использование в persistent mode. Однако на случай, если приложение отжирает слишком много памяти, у него есть и fork mode: он форкает процесс для небольшого числа итераций в persistent mode, после чего прибивает его.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EИспользовать libFuzzer очень легко.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cstrong\u003EHonggfuzz\u003C\u002Fstrong\u003E отличается методами сбора покрытия: фаззер позволяет использовать Intel Branch Trace Store или Intel Processor Trace. Также в нем есть есть стандартная возможность инструментировать приложение во время компиляции и поддержка фаззинга скомпилированных приложений при помощи qemu mode (хотя это есть и у AFL++).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЛегко ли его использовать, сказать не могу: я обходился AFL++ и libFuzzer. Так как собственного опыта работы с honggfuzz у меня нет, дальше в статье я его не касаюсь.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EА вот libFuzzer и AFL++ давайте рассмотрим подробнее.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch3 id=\"libfuzzer-na-praktike\"\u003ELibFuzzer на практике\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДавайте попробуем написать простой обвяз (harness) для фаззинга с libFuzzer.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EУстановите себе Clang, если он еще не поставлен (\u003Ca href=\"https:\u002F\u002Fclang.llvm.org\u002Fget_started.html\" title=\"https:\u002F\u002Fclang.llvm.org\u002Fget_started.html\"\u003Eинструкция\u003C\u002Fa\u003E). Скопируйте следующий код в basic_example.c:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003E#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n\nint LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) {\n    if (size &gt; 0 &amp;&amp; data[0] == 'H')\n        if (size &gt; 1 &amp;&amp; data[1] == 'I')\n            if (size &gt; 3 &amp;&amp; data[2] == '!')\n            __builtin_trap();\n    return 0;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ качестве входа, в который будут подаваться тест-кейсы, в libFuzzer используется следующая функция:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Eint LLVMFuzzerTestOneInput(const uint8_t *data, size_t size)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНа вход передается тест-кейс и его размер. Если возвращаемое значение не равно нулю, то фаззер воспринимает это как обнаруженный баг. Так легко добавлять обнаружение нарушений логики приложения. Если что-то не соответствует ожиданиям, достаточно вернуть не ноль.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ libFuzzer еще определена такая стандартная функция:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"cpp\"\u003Eint LLVMFuzzerInitialize(int *argc, char ***argv)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ нее передаются указатели на аргументы запуска фаззера. Вообще функция нужна не только чтобы изменять их, если они используются внутри программы, но и чтобы произвести всю необходимую инициализацию. Поскольку в нашем примере нет никаких глобальных переменных, мы обошлись без этой функции.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСкомпилируем наш обвяз:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Eclang -fsanitize=fuzzer basic_example.c -o basic_example\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли бы мы хотели добавить ASAN и UBSAN, то нужно было бы компилировать так:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Eclang -fsanitize=fuzzer,address,undefined basic_example.c -o basic_example\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EClang сам добавит все необходимое для persistent mode.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСейчас мы запустим фаззер без каких-либо параметров. В реальном исследовании так делать не стоит: можно потерять много времени впустую из-за пропавших тест-кейсов. Но мы просто хотим проверить игрушечный пример, поэтому запускаем:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fa1\u002Fwi\u002Fcg\u002Fa1wicg-krx1u7cyoo9ycflpq_ry.gif\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fa1\u002Fwi\u002Fcg\u002Fa1wicg-krx1u7cyoo9ycflpq_ry.gif 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fa1\u002Fwi\u002Fcg\u002Fa1wicg-krx1u7cyoo9ycflpq_ry.gif 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EФаззер тут же находит тест-кейс (его можно заметить на видео в конце снизу — «H!HH»), который вызывает прерывание. Тест-кейс сохранен под именем crash-&lt;хеш от содержимого&gt;. Его можно снова передать в исследуемое приложение, чтобы посмотреть стек вызовов:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fda\u002F7w\u002Fg3\u002Fda7wg3ueknjfpfa-qmhgao5w4rc.gif\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fda\u002F7w\u002Fg3\u002Fda7wg3ueknjfpfa-qmhgao5w4rc.gif 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fda\u002F7w\u002Fg3\u002Fda7wg3ueknjfpfa-qmhgao5w4rc.gif 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch3 id=\"a-teper-afl\"\u003EА теперь AFL++\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли исходники уже подготовлены к использованию с libFuzzer, то переделать их под работу с AFL++ в persistent mode тривиально. Достаточно скачать \u003Ca href=\"https:\u002F\u002Fchromium.googlesource.com\u002Fchromium\u002Fllvm-project\u002Fcompiler-rt\u002Flib\u002Ffuzzer.git\u002F+\u002FHEAD\u002Fafl\u002Fafl_driver.cpp\"\u003Eafl_driver.cpp\u003C\u002Fa\u003E, который распространяется в составе LLVM, и скомпилировать под AFL++.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cp\u003EКачаем, собираем и устанавливаем \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAFLplusplus\u002FAFLplusplus\"\u003EAFL++\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EКомпилируем basic_example.c, afl_driver.cpp и линкуем:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Eafl-clang-fast -c basic_example.c\nafl-clang-fast++ -c afl_driver.cpp\nafl-clang-fast++ basic_example.o afl_driver.o -o basic_afl_example\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EСоздаем директории, кладем какой-нибудь файл в input и запускаем:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Emkdir input output; echo \"\" &gt; input\u002F0;\nafl-fuzz -i input -o output -- .\u002Fafl_basic_example\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cdiv class=\"oembed\"\u003E\u003Cdiv class=\"tm-iframe_temp\" data-src=\"https:\u002F\u002Fembedd.srv.habr.com\u002Fiframe\u002F6102aceff2fa57a26f179fb8\" data-style=\"\" id=\"6102aceff2fa57a26f179fb8\" width=\"\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКак видно, AFL++ тоже находит прерывание, но в базовой конфигурации делает это медленнее libFuzzer.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Ch3 id=\"krutizna-afl-i-mutacii\"\u003EКрутизна AFL и мутации\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЯ упоминал, что именно AFL привел к взрыву исследований и разработки в области фаззинга. Но почему именно AFL?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЭто был первый фаззер, который сочетал одновременно несколько особенностей:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EЕго было просто использовать. В случаях с вводом по stdin достаточно было заменить компиляторы GCC\u002FClang на afl-gcc или afl-clang. (Это не значит, что GCC надо заменять на afl-gcc, а Clang на afl-clang. Если хотите этим заняться, посмотрите \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAFLplusplus\u002FAFLplusplus\u002Fblob\u002Fstable\u002FREADME.md\"\u003Eдокументацию AFL++\u003C\u002Fa\u003E и выберите компилятор, который встроит самую быструю инструментацию, доступную вам.)\u003C\u002Fli\u003E\n\u003Cli\u003EОн использовал покрытие ветвей, которое оказалось эффективнее для фаззинга, чем покрытие блоков.\u003C\u002Fli\u003E\n\u003Cli\u003EОн составлял расписание тест-кейсов (schedule) так, чтобы медленные тест-кейсы не отъедали слишком много времени. Расписание фаззера — это алгоритм решения, какие тест-кейсы из корпуса фаззер выбирает на каждом этапе и сколько времени он выделяет на тестирование их мутированных версий. AFL строит очередь из всех тест-кейсов в корпусе, причем при постановке в очередь приоритет отдает новым тест-кейсам. Также AFL настраивает количество запусков PUT с мутированными тест-кейсами, увеличивая или уменьшая его в зависимости от времени выполнения базового тест-кейса, который мутирует в данный момент. Иначе при обнаружении особенно медленного экземпляра ему бы выделялось больше всего времени.\u003C\u002Fli\u003E\n\u003Cli\u003EОн содержал механизмы мутаций и извлечения информации из тест-кейсов, предоставленных в начальном корпусе, которые Michal Zalewski проверил на эффективность опытным путем.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EО последней особенности — механизмах мутации — надо рассказать подробнее.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EМутации — это еще одна составляющая фаззинга, наравне с покрытием, механизмом исполнения PUT, моделью тест-кейсов и оракулами. Есть две основные фазы мутаций:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EДетерминистическая.\u003C\u002Fli\u003E\n\u003Cli\u003EХаос (Havoc).\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ конфигурации по умолчанию AFL начинает \u003Cstrong\u003Eс детерминистической фазы.\u003C\u002Fstrong\u003E Для каждого тест-кейса в стартовом корпусе AFL последовательно применяет следующие мутации (после каждой мутации проверяет PUT с данным тест-кейсом):\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EФлип одного бита в тест-кейсе (0x00 → 0x80).\u003C\u002Fli\u003E\n\u003Cli\u003EФлип последовательной пары битов (0x00 → 0xC0).\u003C\u002Fli\u003E\n\u003Cli\u003EФлип последовательной четверки битов (0x00 → 0xF0).\u003C\u002Fli\u003E\n\u003Cli\u003EИнвертирование байта (0x00 → 0xFF).\u003C\u002Fli\u003E\n\u003Cli\u003EИнвертирование двух последовательных байтов (0x0000 → 0xFFFF).\u003C\u002Fli\u003E\n\u003Cli\u003EИнвертирование четырёх последовательных байтов (0x00000000 → 0xFFFFFFFF).\u003C\u002Fli\u003E\n\u003Cli\u003EДобавление и вычитание из байтов, вордов и двордов малых значений (и в little-endian, и в big-endian).\u003C\u002Fli\u003E\n\u003Cli\u003EЗамена байтов, вордов, двордов на особые значения (1, −1, 0, 127 и пр.).\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EТакие мутации с высокой вероятности изменят работу PUT, если там производится обработка бинарных данных.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПри этом AFL анализирует поведение программы при осуществлении отдельных битфлипов. Например, AFL видит, что работа PUT при флипе 0-го бита меняется, с 0–31 она изменена, а когда флип производится на 32 бите, все возвращается к прежней работе. В этом случае AFL понимает, что, скорее всего, в этих четырех байтах находится \u003Cabbr title=\"Фиксированная константа, определяющая тип файла\"\u003EMAGIC\u003C\u002Fabbr\u003E или другая константа, запоминает ее и добавляет в словарь, который потом использует на хаотической фазе. Это делает его крайне эффективным: если собран большой корпус файлов, которые должна обрабатывать PUT, то AFL с большой вероятностью сможет создать интересную комбинацию из частей известных тест-кейсов.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКогда AFL заканчивает детерминистическую фазу (или сразу, если пользователь ее пропускает), то переходит \u003Cstrong\u003Eв хаотическую фазу.\u003C\u002Fstrong\u003E В этой фазе есть две стратегии:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cul\u003E\n\u003Cli\u003Eпросто хаос;\u003C\u002Fli\u003E\n\u003Cli\u003Eхаос со сплайсингом.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПервая стратегия — просто хаос — одновременно использует несколько мутаций на одном тест-кейсе (не обязательно все сразу):\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EОдиночные битфлипы.\u003C\u002Fli\u003E\n\u003Cli\u003EПодстановка особых значений.\u003C\u002Fli\u003E\n\u003Cli\u003EДобавление и вычитание малых значений.\u003C\u002Fli\u003E\n\u003Cli\u003EЗамена отдельных байтов случайными значениями.\u003C\u002Fli\u003E\n\u003Cli\u003EУдаление блоков байтов.\u003C\u002Fli\u003E\n\u003Cli\u003EЗамена и вставка блоков байтов.\u003C\u002Fli\u003E\n\u003Cli\u003EЗамена блока блоком из одинаковых байтов.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВторая стратегия — хаос со сплайсингом — делает так:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EБерет пару тест-кейсов, которые отличаются как минимум в двух местах.\u003C\u002Fli\u003E\n\u003Cli\u003EРазрывает каждый из них.\u003C\u002Fli\u003E\n\u003Cli\u003EСклеивает разные части.\u003C\u002Fli\u003E\n\u003Cli\u003EПрименяет первую стратегию к результату.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВторая стратегия пытается скомбинировать характеристики двух тест-кейсов, чтобы удовлетворить одновременно несколько условиям в парсере.\u003Cbr\u002F\u003E\n\u003Cbr\u002F\u003E\n\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"esche-ne-konec\"\u003EЕще не конец\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EФух, долгое и мучительное введение в то, как работает фаззер, закончилось.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ следующей статье я расскажу, как улучшались стандартные механизмы фаззеров, чтобы становиться более эффективными.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"уязвимости"},{"titleHtml":"фаззинг"},{"titleHtml":"тестирование по"},{"titleHtml":"информационная безопасность"},{"titleHtml":"взлом"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fla\u002Fco\u002Fs6\u002Flacos6umd28xl-pd9mprrpxikle.jpeg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fla\u002Fco\u002Fs6\u002Flacos6umd28xl-pd9mprrpxikle.jpeg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fbizone\\\u002Farticles\\\u002F570312\\\u002F\"},\"headline\":\"Немного про современные технологии Greybox-фаззинга\",\"datePublished\":\"2021-08-02T12:13:04+03:00\",\"dateModified\":\"2021-08-02T13:44:41+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"BI.ZONE\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fbizone\\\u002Farticles\\\u002F570312\\\u002F#post-content-body\",\"about\":[\"c_bizone\",\"h_infosecurity\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F570312\\\u002F0f6edfc8ddad89c46f16587041aa0871\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fjr\\\u002Fea\\\u002Fj-\\\u002Fjreaj-lia98n2khuvvh8ifghau0.jpeg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fry\\\u002Fbx\\\u002F6c\\\u002Frybx6cexi52bk_t8jqats6nzb7m.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fzg\\\u002Fii\\\u002F_5\\\u002Fzgii_5b35x5dz85awo9qqzxdzk0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fformulas\\\u002F0ba\\\u002F8fc\\\u002F59b\\\u002F0ba8fc59bafc5603168abebe244053a2.svg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fwz\\\u002Fx9\\\u002Fd9\\\u002Fwzx9d93q5x_3ox47vzbqpbgyqo0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fuo\\\u002F7l\\\u002F3q\\\u002Fuo7l3qqa7nseayv8do93sqbds5y.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fh5\\\u002Fiu\\\u002Fub\\\u002Fh5iuubphfwaxivlpeavmoj3qowy.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fav\\\u002Fna\\\u002Fus\\\u002Favnausmdvvsd525jpbjdacjqr4y.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa1\\\u002Fwi\\\u002Fcg\\\u002Fa1wicg-krx1u7cyoo9ycflpq_ry.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fda\\\u002F7w\\\u002Fg3\\\u002Fda7wg3ueknjfpfa-qmhgao5w4rc.gif\"]}","metaDescription":"Автор: Иннокентий Сенновский Как найти баги, о которых вы и не догадывались, или что такое фаззинг Все уже привыкли, что программу надо покрывать тестами, чтобы потом не было стыдно. Но вот проблема:...","mainImageUrl":null,"amp":false,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":null,"banner":null,"multiwidget":null,"multiwidgetUuid":null,"readingTime":20,"complexity":null,"isEditorial":false,"flowNew":null,"allowedFeatures":{"isTestTargetAllow":true}}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":["570312"],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{"570312":{"refs":{"23327768":{"id":"23327768","parentId":null,"level":0,"timePublished":"2021-08-02T13:26:18+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EDirbuster брутит директории в web application. К слову. Аналогия с фаззингом С++ applications имхо такая себе.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"2758383","alias":"bret99","fullname":"Денис Штольц","avatarUrl":null,"speciality":"Infoformation security"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["23327770"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"23327770":{"id":"23327770","parentId":"23327768","level":1,"timePublished":"2021-08-02T13:26:46+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EДа, этот пример «на грани». По сути мы ищем раскрытие информации при помощи проверенного списка путей. Конечно, это очень отличается от Greybox-фаззинга приложений, но Blackbox часто работает именно так.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"1670291","alias":"BiZone_team","fullname":"BI.ZONE","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff4e\u002F26e\u002F0ff\u002Ff4e26e0ffc7aac66add13ccce18c9880.png","speciality":"Пользователь"},"isAuthor":false,"isPostAuthor":true,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":true},"23328608":{"id":"23328608","parentId":null,"level":0,"timePublished":"2021-08-02T16:40:04+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EНе первый раз читаю про фаззинг и возникает вопрос: все эти инструменты могут работать с уже имеющимся исполняемым файлом? Например я хочу пофаззить word.exe из MS Office ;-)\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"36856","alias":"vilgeforce","fullname":"Владимир Мартьянов","avatarUrl":null,"speciality":"Пользователь"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["23329038"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"23329038":{"id":"23329038","parentId":"23328608","level":1,"timePublished":"2021-08-02T19:12:26+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":1,"votesCount":1,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EВ случае бинарного фаззинга всё немного сложнее, взять инструмент, чтобы он сразу заработал, в большинстве случаев не получится. Под Windows можно использовать WinAFL, TinyAFL, Jackalope, есть и другие варианты. Но придется реверсить. Да и MS Office тяжелый таргет. Ну и в случае исполняемых файлов не получается сделать такие же хорошие оракулы багов. Например, слежение за кучей начинает использовать намного больше памяти, а детектировать неправильное чтение буфера на стеке очень сложно, ведь нет информации о границах переменных.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"465022","alias":"Rumata888","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["23329042"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"23329042":{"id":"23329042","parentId":"23329038","level":2,"timePublished":"2021-08-02T19:15:41+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EКак признак бага в оракуле можно было бы использовать необработанные исключения? Я, когда делал свой \"фаззер\" делал именно так, но ни о каком \"умном\" изменении входных данных и тем более о покрытии кода и речи там не шло. А хотелось бы чего-то более эффективного...\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"36856","alias":"vilgeforce","fullname":"Владимир Мартьянов","avatarUrl":null,"speciality":"Пользователь"},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":["23330652"],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false},"23330652":{"id":"23330652","parentId":"23329042","level":3,"timePublished":"2021-08-03T09:23:53+00:00","timeChanged":null,"isSuspended":false,"status":"published","score":0,"votesCount":0,"message":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EДа, необработанные исключения - это оракул багов, который есть в каждой программе. Проблема в том, что он очень слабый. Например, есть такая уязвимость off-by-one. Когда программа промахивается и записывает на один байт больше, чем надо. Например, неправильно посчитали, куда на ставить ноль в строке в C. Поскольку у кучи есть определенная гранулярность, то в большинстве случаев такая перезапись не затронет какие-либо метаданные. Только неиспользуемый кусок выделенного чанка. Оракулы багов нужны, чтобы сразу обнаруживать такие проблемы, потому что и они иногда приводят к эксплуатации. В Windows для этого включают специальную кучу.\u003C\u002Fp\u003E\u003Cp\u003EЕсли хотите попробовать пофаззить какой-то исполняемый файл на Windows, попробуйте \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flinhlhq\u002FTinyAFL\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Flinhlhq\u002FTinyAFL\u003C\u002Fa\u003E или \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgoogleprojectzero\u002FJackalope\" rel=\"noopener noreferrer nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fgoogleprojectzero\u002FJackalope\u003C\u002Fa\u003E . Но лучше начать с чего-то попроще Word.\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","editorVersion":2,"author":{"id":"465022","alias":"Rumata888","fullname":null,"avatarUrl":null,"speciality":null},"isAuthor":false,"isPostAuthor":false,"isNew":false,"isFavorite":false,"isCanEdit":false,"timeEditAllowedTill":null,"children":[],"vote":{"value":null,"isCanVote":false},"votePlus":null,"voteMinus":null,"isPinned":false,"isPublicationAuthor":false}},"root":["23327768","23328608"]}},"articlePinnedComments":{"570312":{"refs":{},"commentIds":[]}},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{"isCanComment":false,"cantCommentReasonKey":"AUTH_REQUIRED","cantCommentReason":"Authorization required","data":null},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":1627982633,"moderated":[],"moderatedIds":[],"commentRoute":"","idempotenceKey":""}},"companies":{"companyRefs":{"bizone":{"alias":"bizone","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F606\u002F14d\u002F823\u002F60614d8230f985b3acdf792bbfe88d35.png","titleHtml":"BI.ZONE","descriptionHtml":null,"relatedData":null,"statistics":{"subscribersCount":37552,"rating":62.35,"invest":null,"postsCount":92,"threadsCount":0,"newsCount":4,"vacanciesCount":0,"employeesCount":8,"careerRating":null},"foundationDate":null,"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"https:\u002F\u002Fbi.zone\u002F","staffNumber":"501–1 000 человек","registrationDate":"2016-11-11T09:46:52+00:00","representativeUser":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fbi.zone\u002F","siteTitle":"BI.ZONE — компания по управлению цифровыми рисками","favicon":"https:\u002F\u002Fbi.zone\u002Fmedia\u002Fimages\u002Ficons\u002Ffavicon.ico"},{"title":"X","url":"https:\u002F\u002Fx.com\u002Fbizone_en","siteTitle":null,"favicon":null},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fbizone_channel","siteTitle":"Telegram: View @bizone_channel","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"}],"settings":{"analyticsSettings":[],"branding":null,"status":"active","isStartup":false,"hasActivePolls":false,"shouldShowHabrAds":true},"metadata":{"titleHtml":"BI.ZONE, Москва - ","title":"BI.ZONE, Москва - ","keywords":["информационная безопасность","защита информации","уязвимости","cve","information security","этичный хакинг","хакеры","атаки","windows","threat intelligence","кибербезопасность","взлом","пентест","критическая уязвимость","rce"],"descriptionHtml":"92 статьи от авторов компании BI.ZONE","description":"92 статьи от авторов компании BI.ZONE"},"aDeskSettings":null,"careerAlias":"bizone","schoolAlias":null}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null,"availableInvitesCount":{}},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":false},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false,"isStickyPanelIconsHidden":false},"flows":{"updates":{}},"global":{"isPwa":false,"device":"desktop","isHabrCom":true,"requestId":"8c2854a9ee228a343b1247fb86f965cf"},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fru\u002Fcompanies\u002Fbizone\u002Farticles\u002F570312\u002F","path":"\u002Fru\u002Fcompanies\u002Fbizone\u002Farticles\u002F570312\u002F","href":"\u002Fru\u002Fcompanies\u002Fbizone\u002Farticles\u002F570312\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0},"features":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"onboarding":{"currentStep":null,"stepsData":{},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{"salary":"project-block-company-article"}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null,"sticker":null,"isPromoDataAvailable":{"featurer":true,"promoPosts":true,"promoLinks":true,"megaposts":true}},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{},"timeTracker":{},"isTrackingActivity":false,"isUserActive":true,"otherPublicationStats":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":null},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{},"eventIds":[],"pagesCount":0,"categories":[],"cities":[],"actualEvents":null,"currentEvent":null,"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null}},"wysiwyg":{"WYSIWYGRulesRefs":null},"refs":{"specializationRefs":[]},"hint":{"hints":{}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="https://assets.habr.com/habr-web/js/chunk-vendors.2fa29ba9.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.9d978772.js" defer></script></div>
    <div id="overlays"><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--></div>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  </script>
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
    </body>

    </html>
